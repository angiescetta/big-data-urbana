<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>BIG DATA URBANA</title>
  <meta name="description" content="BIG DATA URBANA" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="BIG DATA URBANA" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="BIG DATA URBANA" />
  
  
  

<meta name="author" content="Angie Scetta" />


<meta name="date" content="2020-11-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">BIG DATA URBANA</h1>
<h2 class="subtitle"><em>Herramientas y Datos para conocer el Territorio</em></h2>
<p class="author"><em>Angie Scetta</em></p>
<p class="date"><em>2020-11-03</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#introducción">INTRODUCCIÓN</a><ul>
<li><a href="#programa">Programa</a></li>
</ul></li>
<li><a href="#conocer"><span class="toc-section-number">1</span> CONOCER</a><ul>
<li><a href="#interfaz-gráfica-de-rstudio"><span class="toc-section-number">1.1</span> Interfaz Gráfica de RStudio</a></li>
<li><a href="#formato-rmarkdown"><span class="toc-section-number">1.2</span> Formato RMarkdown</a></li>
<li><a href="#nuestro-primer-dataset"><span class="toc-section-number">1.3</span> Nuestro primer dataset</a></li>
</ul></li>
<li><a href="#manipular"><span class="toc-section-number">2</span> MANIPULAR</a><ul>
<li><a href="#filtrar"><span class="toc-section-number">2.1</span> Filtrar</a></li>
<li><a href="#seleccionar"><span class="toc-section-number">2.2</span> Seleccionar</a></li>
<li><a href="#modificar"><span class="toc-section-number">2.3</span> Modificar</a></li>
<li><a href="#ordenar"><span class="toc-section-number">2.4</span> Ordenar</a></li>
<li><a href="#renombrar"><span class="toc-section-number">2.5</span> Renombrar</a></li>
<li><a href="#resumir-y-agrupar"><span class="toc-section-number">2.6</span> Resumir y Agrupar</a></li>
<li><a href="#concatenar-funciones"><span class="toc-section-number">2.7</span> Concatenar funciones (%&gt;%)</a></li>
</ul></li>
<li><a href="#graficar"><span class="toc-section-number">3</span> GRAFICAR</a><ul>
<li><a href="#histograma"><span class="toc-section-number">3.1</span> Histograma</a></li>
<li><a href="#gráfico-de-densidad"><span class="toc-section-number">3.2</span> Gráfico de Densidad</a></li>
<li><a href="#gráfico-de-cajas"><span class="toc-section-number">3.3</span> Gráfico de Cajas</a></li>
<li><a href="#gráfico-de-dispersión"><span class="toc-section-number">3.4</span> Gráfico de Dispersión</a></li>
<li><a href="#gráfico-de-matriz"><span class="toc-section-number">3.5</span> Gráfico de Matriz</a></li>
<li><a href="#gráfico-de-barras"><span class="toc-section-number">3.6</span> Gráfico de Barras</a></li>
</ul></li>
<li><a href="#mapear"><span class="toc-section-number">4</span> MAPEAR</a><ul>
<li><a href="#analizar-datos-espaciales"><span class="toc-section-number">4.1</span> Analizar datos espaciales</a></li>
<li><a href="#cruzar-datos-tradicionales-y-espaciales"><span class="toc-section-number">4.2</span> Cruzar datos tradicionales y espaciales</a></li>
<li><a href="#cruzar-datos-espaciales"><span class="toc-section-number">4.3</span> Cruzar datos espaciales</a></li>
<li><a href="#agregar-mapa-base"><span class="toc-section-number">4.4</span> Agregar mapa base</a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">BIG DATA URBANA</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="introducción" class="section level1 unnumbered">
<h1>INTRODUCCIÓN</h1>
<p>¡Hola a todos!</p>
<p><strong>¡Bienvenidos a BIG DATA URBANA!</strong></p>
<p>Estamos en un momento en que las Ciudades producen millones y millones de datos por segundo y hoy tenemos la posibilidad de aprovecharlos desde nuestra profesión para poder trabajar y tomar decisiones en base a evidencia real.</p>
<p>El objetivo del curso es presentar a los profesionales interesados en analizar diversas variables territoriales (sociodemográficas, mercado inmobiliario, actividad económica, transporte, movilidad, salud, educación, etc), la importancia de conocer herramientas analíticas que les permitan manipular y extraer conocimiento de grandes volúmenes de datos para tomar mejores decisiones a la hora de diagnosticar, comprender e intervenir el territorio.</p>
<p>El curso será práctico y se enseñarán los conocimientos básicos del lenguaje de programación R y del software libre RStudio, y su potencialidad para el análisis de datos urbanos.</p>
<p><img src="images/logos.jpg" /></p>
<p>A lo largo de 4 clases aplicaremos la herramienta a un ejemplo real, con el fin de analizar, describir, interpretar, visualizar y extraer conocimiento de datos existentes. El caso de estudio será el mercado inmobiliario en CABA y se utilizarán datos provenientes de fuentes públicas.</p>
<p>Será un curso de 4 clases de 3hs donde se estima un 90% práctico y un 10% teórico.</p>
<div id="programa" class="section level2 unnumbered">
<h2>Programa</h2>
<p><strong>Clase 1: CONOCER</strong></p>
<p>¿Qué es la Ciencia de Datos? ¿Cómo utilizar grandes volúmenes de datos para analizar dinámicas urbanas? ¿Qué datos existen? ¿Qué información contienen las bases de datos? ¿Cómo se estructuran?</p>
<p>Introducción a programación en lenguaje R y el software RStudio.</p>
<p>Para esta clase será necesario tener previamente instalado el lenguaje de programación R (<a href="https://cloud.r-project.org/" class="uri">https://cloud.r-project.org/</a>), y la interfaz gráfica RStudio Desktop (<a href="https://rstudio.com/products/rstudio/download/" class="uri">https://rstudio.com/products/rstudio/download/</a>).</p>
<p>En el caso de no poder instalar correctamente el programa, se recomienda utilizar RStudio Cloud (<a href="https://rstudio.cloud/" class="uri">https://rstudio.cloud/</a>).</p>
<p><strong>Clase 2: MANIPULAR</strong></p>
<p>Las funciones de <em>tidyverse</em> para interpretar, manipular y transformar los datos: Extraer información útil a partir de Seleccionar, Filtrar, Ordenar, Modificar, Resumir, Agrupar y Renombrar los datos.</p>
<p><strong>Clase 3: GRAFICAR</strong></p>
<p>¿Qué dicen los datos? ¿Cómo puedo facilitar la comprensión de la información?</p>
<p>Extraer conocimiento de los datos a partir de la visualización de los mismos. Comunicar resultados a partir de gráficos.</p>
<p><strong>Clase 4: MAPEAR</strong></p>
<p>¿Dónde se ubican los datos? ¿Cómo se distribuyen en el territorio? ¿Presentan algún patrón espacial?</p>
<p>Análisis espacial de los datos. Visualización e interpretación a partir de mapas.</p>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="conocer" class="section level1">
<h1><span class="header-section-number">1</span> CONOCER</h1>
<p><strong>¿Qué es R y RStudio?</strong></p>
<p>RStudio es una <strong>interfaz libre y gratuita</strong> que nos permite <strong>explotar todo el potencial que tiene el lenguaje de programación R</strong>.</p>
<p>R es un lenguaje que ofrece una gran variedad de funciones para realizar cálculos estadísticos y generar diversos gráficos a partir de los datos. Sin embargo, el gran potencial está en que, al ser libre y colaborativo, <strong>constantemente los usuarios están actualizando y ampliando la cantidad de funciones que presenta</strong>. Hoy en día podemos realizar desde operaciones básicas sobre los datos hasta aplicar algoritmos de inteligencia artificial.</p>
<p>A su vez, dentro de RStudio, hay diferentes formatos de archivos (RMarkdown, RScript, RNotebook, etc) que su elección depende del objetivo que tengamos. En nuestro caso, a lo largo del curso trabajaremos con el formato <strong>RMarkdown</strong>, un tipo de documento de RStudio que integra texto con código de R y nos permite generar informes a partir de los datos.</p>
<p>Empecemos de a poco:</p>
<p>Primero tenemos que crear un <strong>nuevo proyecto y un nuevo RMarkdown</strong>. Los pasos a seguir pueden encontrarlos en el siguiente tutorial: <strong><a href="https://rpubs.com/angiescetta/conociendo-R" class="uri">https://rpubs.com/angiescetta/conociendo-R</a></strong></p>
<div id="interfaz-gráfica-de-rstudio" class="section level2">
<h2><span class="header-section-number">1.1</span> Interfaz Gráfica de RStudio</h2>
<p>Antes de seguir, analicemos un poco la <strong>Interfaz Gráfica de RStudio</strong>:</p>
<p><img src="images/000_0.jpg" /></p>
<p>Tal como se ve en la imagen, podríamos dividir la interfaz en 4 partes/ventanas:</p>
<ol style="list-style-type: decimal">
<li><strong>Panel de Edición</strong></li>
</ol>
<p>Este panel es en el que vamos a estar creando y modificando nuestro RMarkdown. Aquí también podría haber otro formato de archivo R, como por ejemplo R Script o R Notebook.</p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Entorno de Variables</strong></li>
</ol>
<p>En esta ventana iremos viendo todos los datos que hayamos cargado. Desde aquí también podremos importar o eliminar datos.</p>
<p>Desde la pestaña Historial podremos consultar el historial de comandos y funciones que fuimos utilizando en el Proyecto.</p>
<ol start="3" style="list-style-type: decimal">
<li><strong>Consola</strong></li>
</ol>
<p>En la ventana inferior izquierda irá apareciendo todo lo que ejecutemos tanto desde el Panel de Edición como desde el Entorno de Variables, pero también podemos escribir líneas de código que queremos que se ejecuten y no queremos dejarlas escritas en el RMarkdown.</p>
<ol start="4" style="list-style-type: decimal">
<li><strong>Panel de Utilidades</strong></li>
</ol>
<p>En la ventana inferior derecha se pueden ver varias cosas:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Files: El Directorio donde estamos trabajando.</p></li>
<li><p>Plots: Las visualizaciones/gráficos que se van generando.</p></li>
<li><p>Packages: Los paquetes de R disponibles.</p></li>
<li><p>Help: Una sección de ayuda donde podemos consultar información de las funciones.</p></li>
<li><p>Viewer: Un visor HTML para ver los gráficos interactivos o animados que hayamos hecho.</p></li>
</ol>
</div>
<div id="formato-rmarkdown" class="section level2">
<h2><span class="header-section-number">1.2</span> Formato RMarkdown</h2>
<p><strong>¿Para que sirve el formato RMawkdown?</strong></p>
<p>Este formato sirve para manipular datos y armar informes listos para presentar. Hay 2 formas de escribir en un RMarkdown:</p>
<ol style="list-style-type: decimal">
<li><strong>Texto</strong> como el que estoy escribiendo ahora.</li>
</ol>
<p>El RMarkdown tiene una sintaxis específica para poder dar formato al texto del informe final, por ejemplo si escribimos así:</p>
<p><img src="images/000.JPG" /></p>
<p>Obtenemos los siguientes resultados:</p>
<p><img src="images/000_1.JPG" /></p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Bloques de código</strong> (o “chunks”) donde insertaremos nuestras líneas de código con el objetivo de manipular (analizar, modificar, visualizar) los datos. Esto es un chunk:</li>
</ol>
<p><img src="images/001.JPG" /></p>
<p>Y se inserta haciendo click en <strong>Insert/R</strong> o con el siguiente atajo en el teclado: <strong>Ctrl + Shift + I</strong></p>
<p><img src="images/002.jpg" /></p>
</div>
<div id="nuestro-primer-dataset" class="section level2">
<h2><span class="header-section-number">1.3</span> Nuestro primer dataset</h2>
<p>A lo largo del curso vamos a trabajar con los datos de Properati, un portal web de compra, venta y alquiler de inmuebles en toda América Latina.
Estos datos son públicos y pueden encontrarlos en <a href="https://properati.com.ar/data" class="uri">https://properati.com.ar/data</a>.</p>
<p>En este caso, para facilitar la manipulación de la información, usaremos un set de datos (en formato csv) previamente procesado que contiene datos de propiedades publicadas en AMBA en Junio y Julio del 2020. Pueden descargarlo de <a href="https://data.world/angie-scetta/amba-properati" class="uri">https://data.world/angie-scetta/amba-properati</a>.</p>
<p><em>Recomendación: Al descargarlo, moverlo de la carpeta “Descargas” a una nueva carpeta llamada “data” dentro de la carpeta del Proyecto donde estén trabajando.</em></p>
<p>Ahora si, manos a la obra! Para cargar el dataset pueden copiar la siguiente línea de código y pegarla dentro de un chunk:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>datos_amba &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/amba_properati.csv&quot;</span>)</span></code></pre></div>
<p>Para entender la lógica detrás del chunk anterior pueden revisar este link: <a href="https://rpubs.com/angiescetta/importar-dataset" class="uri">https://rpubs.com/angiescetta/importar-dataset</a></p>
<p><strong>Ahora conozcamos nuestro dataset</strong>: Veamos como se estructura (cuantas filas y columnas tiene) y que información trae…</p>
<p>Para esto empezaremos utilizando <code>dim()</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">dim</span>(datos_amba)</span></code></pre></div>
<pre><code>## [1] 14929    13</code></pre>
<p>Podemos ver que tenemos 14.929 registros/filas y 13 columnas. También podríamos ver esto por separado de la siguiente forma:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">ncol</span>(datos_amba)</span></code></pre></div>
<pre><code>## [1] 13</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">nrow</span>(datos_amba)</span></code></pre></div>
<pre><code>## [1] 14929</code></pre>
<p>Pero <strong>¿Qué información contienen esas 13 columnas?</strong></p>
<p>Esto podemos verlo con <code>names()</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">names</span>(datos_amba)</span></code></pre></div>
<pre><code>##  [1] &quot;created_on&quot;      &quot;provincia&quot;       &quot;partido&quot;        
##  [4] &quot;rooms&quot;           &quot;surface_total&quot;   &quot;surface_covered&quot;
##  [7] &quot;price&quot;           &quot;currency&quot;        &quot;title&quot;          
## [10] &quot;property_type&quot;   &quot;operation_type&quot;  &quot;lat&quot;            
## [13] &quot;lon&quot;</code></pre>
<p>Bien, las columnas tienen fecha de publicación de la propiedad, provincia y partido donde se ubica, cantidad de ambientes, superficie total y superficie cubierta, precio publicado, tipo de moneda (ARS o USD), el título que el usuario escribió al publicar su propiedad, el tipo de propiedad, el tipo de operación, y finalmente la ubicación del inmueble con sus coordenadas: latitud y longitud.</p>
<p>Parece que cada fila/registro de la base corresponde a una propiedad publicada, pero veamos una pequeña muestra de la data con <code>head()</code> para estar seguros:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">head</span>(datos_amba)</span></code></pre></div>
<pre><code>##   created_on provincia       partido rooms surface_total surface_covered
## 1     202006      CABA      Comuna 7     1            40              37
## 2     202006      CABA     Comuna 13     1            30              30
## 3     202006      CABA     Comuna 13     1            31              29
## 4     202006      CABA      Comuna 1     1            35              35
## 5     202006       GBA Vicente López     1            36              27
## 6     202006       GBA    La Matanza     2            24              24
##   price currency
## 1 22500      ARS
## 2 18000      ARS
## 3 17900      ARS
## 4 42000      ARS
## 5 19000      ARS
## 6 12000      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type operation_type       lat       lon
## 1  Departamento       Alquiler -34.61917 -58.46222
## 2  Departamento       Alquiler -34.55460 -58.46652
## 3  Departamento       Alquiler -34.56318 -58.46461
## 4  Departamento       Alquiler -34.61836 -58.36090
## 5  Departamento       Alquiler -34.53344 -58.49345
## 6            PH       Alquiler -34.66253 -58.52914</code></pre>
<p>Y un <strong>resumen estadístico de la información</strong>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">summary</span>(datos_amba)</span></code></pre></div>
<pre><code>##    created_on     provincia        partido         rooms       
##  Min.   :202006   CABA:8896   Comuna 14:2001   Min.   : 1.000  
##  1st Qu.:202006   GBA :6033   Tigre    :1222   1st Qu.: 2.000  
##  Median :202006               Comuna 13:1193   Median : 3.000  
##  Mean   :202006               Comuna 15:1077   Mean   : 3.057  
##  3rd Qu.:202007               Comuna 2 : 853   3rd Qu.: 4.000  
##  Max.   :202007               Comuna 1 : 765   Max.   :10.000  
##                               (Other)  :7818                   
##  surface_total  surface_covered      price         currency   
##  Min.   :  10   Min.   : 10.00   Min.   :  10000   ARS: 3251  
##  1st Qu.:  51   1st Qu.: 46.00   1st Qu.:  72000   USD:11678  
##  Median :  75   Median : 66.00   Median : 140000              
##  Mean   : 117   Mean   : 91.98   Mean   : 206342              
##  3rd Qu.: 130   3rd Qu.:108.00   3rd Qu.: 250000              
##  Max.   :5000   Max.   :882.00   Max.   :3000000              
##                                                               
##                                                   title      
##  Departamento de 2 ambientes en Venta en Villa crespo:  182  
##  Departamento de 2 ambientes en Venta en Almagro     :  124  
##  Departamento de 2 ambientes en Venta en Palermo     :  124  
##  Departamento de 3 ambientes en Venta en Villa crespo:  121  
##  Departamento de 3 ambientes en Venta en Almagro     :  108  
##  Departamento de 3 ambientes en Venta en Palermo     :  108  
##  (Other)                                             :14162  
##       property_type    operation_type       lat              lon        
##  Casa        : 2297   Alquiler: 3251   Min.   :-35.12   Min.   :-59.04  
##  Departamento:11344   Venta   :11678   1st Qu.:-34.61   1st Qu.:-58.53  
##  PH          : 1288                    Median :-34.59   Median :-58.45  
##                                        Mean   :-34.59   Mean   :-58.47  
##                                        3rd Qu.:-34.55   3rd Qu.:-58.41  
##                                        Max.   :-34.26   Max.   :-57.83  
## </code></pre>
<p>A priori, en este resumen podemos entender varias cosas de la data. Por ejemplo:</p>
<ul>
<li><p>Hay registros de propiedades publicadas entre <strong>Junio (Min) y Julio (Max) 2020</strong>.</p></li>
<li><p>La <strong>mayoría de las publicaciones son en CABA</strong> (8.896 vs 6.033).</p></li>
<li><p>El <strong>Partido/Comuna que más aparece es la Comuna 14</strong> (Barrio de Palermo), seguido por Tigre.</p></li>
<li><p>De las 3 tipologías de propiedades, <strong>lo que más hay es Departamentos</strong>, seguido por Casas y por último PHs.</p></li>
<li><p>Hay <strong>más propiedades en Venta que en Alquiler</strong> (11.678 vs 3.251).</p></li>
</ul>
<p>Por último, investiguemos como es la <strong>estructura de la data</strong>, es decir que tipo de información tiene cada campo. Si bien algo ya nos imaginamos gracias al <code>summary()</code>, usemos <code>str()</code> para revisarlo:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">str</span>(datos_amba)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:	14929 obs. of  13 variables:
##  $ created_on     : int  202006 202006 202006 202006 202006 202006 202006 202006 202006 202006 ...
##  $ provincia      : Factor w/ 2 levels &quot;CABA&quot;,&quot;GBA&quot;: 1 1 1 1 2 2 2 1 1 1 ...
##  $ partido        : Factor w/ 50 levels &quot;Almirante Brown&quot;,..: 18 10 10 6 50 31 27 10 10 6 ...
##  $ rooms          : int  1 1 1 1 1 2 2 2 2 2 ...
##  $ surface_total  : int  40 30 31 35 36 24 40 60 53 39 ...
##  $ surface_covered: int  37 30 29 35 27 24 40 50 44 34 ...
##  $ price          : int  22500 18000 17900 42000 19000 12000 15000 32000 26000 14000 ...
##  $ currency       : Factor w/ 2 levels &quot;ARS&quot;,&quot;USD&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ title          : Factor w/ 10634 levels &quot;- Casa Venta Tipo Chalet 5 Amb con Cochera - Villa Pueyrredo&quot;,..: 2864 8265 2810 7014 1091 7646 7622 4885 8682 2741 ...
##  $ property_type  : Factor w/ 3 levels &quot;Casa&quot;,&quot;Departamento&quot;,..: 2 2 2 2 2 3 3 2 2 2 ...
##  $ operation_type : Factor w/ 2 levels &quot;Alquiler&quot;,&quot;Venta&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ lat            : num  -34.6 -34.6 -34.6 -34.6 -34.5 ...
##  $ lon            : num  -58.5 -58.5 -58.5 -58.4 -58.5 ...</code></pre>
<p>Existen varios tipos de datos, pero en nuestro set nos encontramos con 3: integer (int), numeric (num) y Factor.</p>
<p>Ahora bien, ¿Qué significa eso?</p>
<ul>
<li><p><strong>Integer</strong> son números enteros, es decir que el campo solo admite números sin decimales como por ejemplo cantidad de habitaciones de una propiedad.</p></li>
<li><p><strong>Numeric</strong> son números con decimales, como por ejemplo, latitud y longitud.</p></li>
<li><p><strong>Factor</strong> son categorías, por ejemplo Barrios, Partidos, Tipos de propiedades, etc.</p></li>
</ul>
<p>Además del tipo de dato, con <code>str()</code> también podemos ver la cantidad de niveles que tienen las variables de tipo Factor. Por ejemplo, se observa que la columna provincia solo tiene 2 categorías posibles (CABA o AMBA), en cambio la columna partido tiene 50.</p>
<p><strong>Bonus Track</strong></p>
<p>¿Cómo hacemos si queremos ver la estructura o un resumen estadístico de una sola de las columnas del dataset? Para esto utilizamos el símbolo <strong>$</strong> de la siguiente forma:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">summary</span>(datos_amba<span class="op">$</span>property_type)</span></code></pre></div>
<pre><code>##         Casa Departamento           PH 
##         2297        11344         1288</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">str</span>(datos_amba<span class="op">$</span>property_type)</span></code></pre></div>
<pre><code>##  Factor w/ 3 levels &quot;Casa&quot;,&quot;Departamento&quot;,..: 2 2 2 2 2 3 3 2 2 2 ...</code></pre>
<p><strong>Generemos nuestro primer HTML</strong></p>
<p>Por último, generemos nuestro primer reporte HTML para poder ver todos los resultados en un único informe. Para esto debemos hacer click en <strong>Knit / Knit to HTML</strong>:</p>
<p><img src="images/004.jpg" /></p>
<p><strong>Próximos Pasos</strong></p>
<p>Acá concluye la primer clase, pero los invito a que repliquen lo realizado con algún otro dataset que les interese. Pueden descargar datos de diversos portales abiertos como por ejemplo:</p>
<ul>
<li><p>Portal de Datos Abiertos de Argentina: <a href="https://datos.gob.ar/" class="uri">https://datos.gob.ar/</a></p></li>
<li><p>Portal de Datos Abiertos de CABA: <a href="https://data.buenosaires.gob.ar/" class="uri">https://data.buenosaires.gob.ar/</a></p></li>
<li><p>Portal de Datos Abiertos de PBA: <a href="https://catalogo.datos.gba.gob.ar/" class="uri">https://catalogo.datos.gba.gob.ar/</a></p></li>
<li><p>O de cualquier otro portal de datos que conozcan o encuentren!</p></li>
</ul>
<!--chapter:end:01-conocer.Rmd-->
</div>
</div>
<div id="manipular" class="section level1">
<h1><span class="header-section-number">2</span> MANIPULAR</h1>
<p>Ahora que ya sabemos abrir un dataset y conocer que información tiene, vamos a aprender a manipular y transformar los datos. Para esto vamos a trabajar con uno de los paquetes más usados y más útiles de R que se llama <code>tidyverse</code>.</p>
<p>Pero, <strong>¿Qué es un paquete?</strong></p>
<p>Cuando instalamos R ya viene con múltiples funciones básicas para manipular datos, sin embargo el potencial de R surge con la posibilidad de incorporar constantemente nuevas funciones que nos permitan realizar nuevas tareas o mejorar el resultado de las ya existentes.</p>
<p>Estos grupos de funciones son a los que llamamos paquetes o packages y para poder utilizarlos es necesario <strong>instalarlos por única vez en la computadora</strong>, y luego <strong>activarlos cada vez que vayamos a usarlos</strong>.</p>
<p>Comencemos instalándolo. Esto podemos hacerlo manualmente en Tools/Install packages:</p>
<p><img src="images/005.jpg" /></p>
<p>O directamente escribiendo <code>install.packages()</code> adentro de un chunk:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co">#install.packages(&quot;tidyverse&quot;)</span></span></code></pre></div>
<p>Una vez que instalamos el paquete, no vamos a tener que volver a hacerlo. Solamente vamos a tener que “activarlo” cada vez que queramos usarlo. Esta activación se hace con <code>library()</code> así:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<p>Ahora volvamos a cargar nuestro dataset (el mismo de la clase anterior):</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>datos_amba &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/amba_properati.csv&quot;</span>)</span></code></pre></div>
<p>A continuación veremos como el paquete <code>tidyverse</code> nos va a permitir manipular nuestros datos a partir de las funciones: <strong>filtrar</strong>, <strong>modificar</strong>, <strong>seleccionar</strong>, <strong>ordenar</strong>, <strong>renombrar</strong>, <strong>resumir</strong> y <strong>agrupar</strong>.</p>
<p>Aprender a utilizar todas estas funciones es muy importante ya que la <strong>comprensión, transformación y limpieza de los datos</strong> es la etapa que más tiempo nos llevará a la hora de encarar cualquier proyecto de Ciencia de Datos.</p>
<div id="filtrar" class="section level2">
<h2><span class="header-section-number">2.1</span> Filtrar</h2>
<p>Como su nombre lo indica, esta función hace referencia a realizar un filtro determinado sobre los registros/filas de toda la base de datos, es decir, quedarnos solo con las filas que cumplan cierta condición establecida. Gráficamente se vería como algo así:</p>
<p><img src="images/tidyverse_filtrar.jpg" /></p>
<p>Esto nos será muy útil si por algún motivo queremos dejar de lado registros y utilizar solo una parte de la base. Por ejemplo, en el caso de nuestro dataset, que ya vimos que incluye datos de AMBA y CABA, podríamos filtrar la data y quedarnos solo con los registros ubicados en CABA:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>filtro &lt;-<span class="st"> </span><span class="kw">filter</span>(datos_amba, provincia<span class="op">==</span><span class="st">&quot;CABA&quot;</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="kw">head</span>(filtro)</span></code></pre></div>
<pre><code>##   created_on provincia   partido rooms surface_total surface_covered price
## 1     202006      CABA  Comuna 7     1            40              37 22500
## 2     202006      CABA Comuna 13     1            30              30 18000
## 3     202006      CABA Comuna 13     1            31              29 17900
## 4     202006      CABA  Comuna 1     1            35              35 42000
## 5     202006      CABA Comuna 13     2            60              50 32000
## 6     202006      CABA Comuna 13     2            53              44 26000
##   currency                                                           title
## 1      ARS                                           Departamento - Flores
## 2      ARS           Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3      ARS                                         Departamento - Belgrano
## 4      ARS                Monoambiente con cochera. Zencity. Puerto Madero
## 5      ARS Depto 2AMB c/ Suite y Toilette  - Deheza 1600 - Incluye Cochera
## 6      ARS       Unico 2 ambientes A Estrenar! Posesion inmediata! - Nuñez
##   property_type operation_type       lat       lon
## 1  Departamento       Alquiler -34.61917 -58.46222
## 2  Departamento       Alquiler -34.55460 -58.46652
## 3  Departamento       Alquiler -34.56318 -58.46461
## 4  Departamento       Alquiler -34.61836 -58.36090
## 5  Departamento       Alquiler -34.53795 -58.46671
## 6  Departamento       Alquiler -34.54756 -58.47037</code></pre>
<p>O los del mes de Julio 2020:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>filtro &lt;-<span class="st"> </span><span class="kw">filter</span>(datos_amba, created_on<span class="op">==</span><span class="dv">202007</span>)</span>
<span id="cb25-2"><a href="#cb25-2"></a></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="kw">head</span>(filtro)</span></code></pre></div>
<pre><code>##   created_on provincia   partido rooms surface_total surface_covered price
## 1     202007       GBA     Tigre     2           108              69 20000
## 2     202007       GBA     Tigre     2            57              45 27500
## 3     202007      CABA Comuna 14     1            45              40 23000
## 4     202007      CABA Comuna 14     2            48              48 30000
## 5     202007      CABA Comuna 14     2            42              37 26000
## 6     202007      CABA Comuna 15     2            41              38 21000
##   currency
## 1      ARS
## 2      ARS
## 3      ARS
## 4      ARS
## 5      ARS
## 6      ARS
##                                                              title
## 1 DEPARTAMENTO EN ALQUILER EN NORDELTA 2 AMB CON TERRAZA Y JACUZZI
## 2        2 ambientes con cochera y baulera - Vista al Lago Central
## 3                  Departamento en Alquiler con Balcón y Amenities
## 4   Botánico - 2 ambientes amueblado con vista a Boulevard Cerviño
## 5                                           Departamento - Palermo
## 6               Departamento de 2 ambientes en Alquiler en Palermo
##   property_type operation_type       lat       lon
## 1  Departamento       Alquiler -34.39437 -58.64925
## 2  Departamento       Alquiler -34.40910 -58.63129
## 3  Departamento       Alquiler -34.59274 -58.42749
## 4  Departamento       Alquiler -34.57914 -58.41289
## 5  Departamento       Alquiler -34.59571 -58.41587
## 6  Departamento       Alquiler -34.59856 -58.43026</code></pre>
<p>Nótese que para filtrar bajo la condición de “igual” utilicé “==”, pero también podría haber utilizado otras condiciones como:</p>
<ul>
<li><strong>A==B</strong> -&gt; A igual a B</li>
<li><strong>A!=B</strong> -&gt; A diferente a B</li>
<li><strong>A&lt;B</strong> -&gt; A menor a B</li>
<li><strong>A&lt;=B</strong> -&gt; A menor o igual a B</li>
<li><strong>A&gt;B</strong> -&gt; A mayor a B</li>
<li><strong>A&gt;=B</strong> -&gt; A mayor o igual a B</li>
<li><strong>is.na(A)</strong> -&gt; A tiene valor nulo (NA)</li>
<li><strong>!is.na(A)</strong>-&gt; A no tiene valor nulo (NA)</li>
<li><strong>A%in%B</strong> -&gt; A incluye el valor B</li>
<li><strong>!(A%in%B)</strong>-&gt; A no incluye el valor de B</li>
</ul>
<p>Entonces, por ejemplo si quiero quedarme solo con las propiedades que tienen una superficie cubierta mayor o igual a 75m2 debería escribirlo así:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>filtro &lt;-<span class="st"> </span><span class="kw">filter</span>(datos_amba, surface_covered<span class="op">&gt;=</span><span class="dv">75</span>)</span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="kw">head</span>(filtro)</span></code></pre></div>
<pre><code>##   created_on provincia   partido rooms surface_total surface_covered
## 1     202006       GBA Ituzaingó     3            75              75
## 2     202006       GBA     Tigre     3            95              80
## 3     202006       GBA     Tigre     3            98              90
## 4     202006      CABA Comuna 13     3           109              94
## 5     202006      CABA Comuna 14     3           152             152
## 6     202006      CABA Comuna 14     3            90              85
##    price currency
## 1  19000      ARS
## 2  42000      ARS
## 3  42000      ARS
## 4  90000      ARS
## 5 240000      ARS
## 6  80000      ARS
##                                                                                              title
## 1                                            Americana a 6 cuadras de la estacion de S.A. de Padua
## 2                                   3 AMBIENTES EN EDIFICIO MIRADORES DE LA BAHIA CON COCHERA FIJA
## 3 ¡EN EXCLUSIVA! Departamento en alquiler de 3 ambientes Miradores de La Bahía, Bahía de Nordelta.
## 4                                                  Alquiler Depto 3 Amb a Estrenar Nuñez C/Cochera
## 5           ALQUILER en TORRES DE GELLY 152 m2 con 2 dorm dep y 1 coch ALTO vista Rio  SIN muebles
## 6                                    ALQUILER 3 AMB CON DEPENDENCIA! - Y COCHERA TORRE AMENITIES!!
##   property_type operation_type       lat       lon
## 1          Casa       Alquiler -34.65957 -58.69712
## 2  Departamento       Alquiler -34.39642 -58.64665
## 3  Departamento       Alquiler -34.39512 -58.64665
## 4  Departamento       Alquiler -34.54521 -58.46286
## 5  Departamento       Alquiler -34.57760 -58.40499
## 6  Departamento       Alquiler -34.59353 -58.41462</code></pre>
<p>O si quiero eliminar los registros que corresponden a departamentos debería hacer el siguiente chunk:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>filtro &lt;-<span class="st"> </span><span class="kw">filter</span>(datos_amba, property_type<span class="op">!=</span><span class="st">&quot;Departamento&quot;</span>)</span>
<span id="cb29-2"><a href="#cb29-2"></a></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="kw">head</span>(filtro)</span></code></pre></div>
<pre><code>##   created_on provincia            partido rooms surface_total
## 1     202006       GBA         La Matanza     2            24
## 2     202006       GBA General San Martín     2            40
## 3     202006       GBA          Ituzaingó     3            75
## 4     202006      CABA          Comuna 14     4           125
## 5     202006       GBA              Merlo     4           180
## 6     202006       GBA              Pilar     4           267
##   surface_covered price currency
## 1              24 12000      ARS
## 2              40 15000      ARS
## 3              75 19000      ARS
## 4             105 85000      ARS
## 5             140 27000      ARS
## 6             267 50000      ARS
##                                                   title property_type
## 1                                PH - Lomas Del Mirador            PH
## 2                                        PH - Chilavert            PH
## 3 Americana a 6 cuadras de la estacion de S.A. de Padua          Casa
## 4              PH en alquiler 4 ambientes - Las Cañitas            PH
## 5               Casa en Padua 3 dormitorios en alquiler          Casa
## 6              Casa en venta o alquiler en La Peregrina          Casa
##   operation_type       lat       lon
## 1       Alquiler -34.66253 -58.52914
## 2       Alquiler -34.54301 -58.57573
## 3       Alquiler -34.65957 -58.69712
## 4       Alquiler -34.57207 -58.43249
## 5       Alquiler -34.66154 -58.71565
## 6       Alquiler -34.47091 -58.82270</code></pre>
<p>Si queremos filtrar todas las propiedades ubicadas en 3 partidos diferentes como por ejempo La Plata, General San Martín y La Matanza debemos utilizar %in% de la siguiente forma:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>filtro &lt;-<span class="st"> </span><span class="kw">filter</span>(datos_amba, partido <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;La Plata&quot;</span>, <span class="st">&quot;General San Martín&quot;</span>, <span class="st">&quot;La Matanza&quot;</span>))</span>
<span id="cb31-2"><a href="#cb31-2"></a></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="kw">head</span>(filtro)</span></code></pre></div>
<pre><code>##   created_on provincia            partido rooms surface_total
## 1     202006       GBA         La Matanza     2            24
## 2     202006       GBA General San Martín     2            40
## 3     202006       GBA           La Plata     2            50
## 4     202006       GBA           La Plata     2            35
## 5     202006       GBA General San Martín     2            56
## 6     202006       GBA           La Plata     3            40
##   surface_covered price currency
## 1              24 12000      ARS
## 2              40 15000      ARS
## 3              50 18000      ARS
## 4              35 13500      ARS
## 5              48 14000      ARS
## 6              40 10000      ARS
##                                                         title
## 1                                      PH - Lomas Del Mirador
## 2                                              PH - Chilavert
## 3 Alquiler, depto de un domitorio frente al parque San Martin
## 4                                     Departamento - La Plata
## 5                     Departamento céntrico - Villa Ballester
## 6                               Departamento - José Hernández
##   property_type operation_type       lat       lon
## 1            PH       Alquiler -34.66253 -58.52914
## 2            PH       Alquiler -34.54301 -58.57573
## 3  Departamento       Alquiler -34.93415 -57.96605
## 4  Departamento       Alquiler -34.90645 -57.97335
## 5  Departamento       Alquiler -34.55038 -58.55512
## 6  Departamento       Alquiler -34.89768 -58.02787</code></pre>
<p>En cambio, si queremos filtrar todas las propiedades que no estén ubicadas en 3 partidos diferentes como por ejempo La Plata, General San Martín y La Matanza debemos utilizar ! + %in% de la siguiente forma:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>filtro &lt;-<span class="st"> </span><span class="kw">filter</span>(datos_amba, <span class="op">!</span>(partido <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;La Plata&quot;</span>, <span class="st">&quot;General San Martín&quot;</span>, <span class="st">&quot;La Matanza&quot;</span>)))</span>
<span id="cb33-2"><a href="#cb33-2"></a></span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="kw">head</span>(filtro)</span></code></pre></div>
<pre><code>##   created_on provincia       partido rooms surface_total surface_covered
## 1     202006      CABA      Comuna 7     1            40              37
## 2     202006      CABA     Comuna 13     1            30              30
## 3     202006      CABA     Comuna 13     1            31              29
## 4     202006      CABA      Comuna 1     1            35              35
## 5     202006       GBA Vicente López     1            36              27
## 6     202006      CABA     Comuna 13     2            60              50
##   price currency
## 1 22500      ARS
## 2 18000      ARS
## 3 17900      ARS
## 4 42000      ARS
## 5 19000      ARS
## 6 32000      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6               Depto 2AMB c/ Suite y Toilette  - Deheza 1600 - Incluye Cochera
##   property_type operation_type       lat       lon
## 1  Departamento       Alquiler -34.61917 -58.46222
## 2  Departamento       Alquiler -34.55460 -58.46652
## 3  Departamento       Alquiler -34.56318 -58.46461
## 4  Departamento       Alquiler -34.61836 -58.36090
## 5  Departamento       Alquiler -34.53344 -58.49345
## 6  Departamento       Alquiler -34.53795 -58.46671</code></pre>
<p>Pero esto no es todo, ¿Cómo hago si quiero filtrar por <strong>2 o más condiciones a la vez</strong>?</p>
<p>En este caso debemos utilizar los siguientes operadores lógicos:</p>
<ul>
<li>condición 1 <strong>&amp;</strong> condición 2 -&gt; se cumplen ambas condiciones a la vez</li>
<li>condición 1 <strong>|</strong> condición 2 -&gt; se cumple una u otra de las condiciones</li>
<li>condición 1 <strong>&amp; !</strong> condición 2 -&gt; se cumple la condición 1 pero no la condición 2</li>
<li><strong>!</strong>condición 1 <strong>&amp;</strong> condición 2 -&gt; no se cumple la condición 1 pero si la condición 2</li>
<li><strong>!</strong>(condición 1 <strong>&amp;</strong> condición 2) -&gt; no se cumple ninguna de las 2 condiciones</li>
</ul>
<p>Por ejemplo, si queremos filtrar todos los registros pertenecientes a la Comuna 5 y a la Comuna 13:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>filtro &lt;-<span class="st"> </span><span class="kw">filter</span>(datos_amba, partido<span class="op">==</span><span class="st">&quot;Comuna 5&quot;</span> <span class="op">&amp;</span><span class="st"> </span>partido<span class="op">==</span><span class="st">&quot;Comuna 13&quot;</span>)</span>
<span id="cb35-2"><a href="#cb35-2"></a></span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="kw">head</span>(filtro)</span></code></pre></div>
<pre><code>##  [1] created_on      provincia       partido         rooms          
##  [5] surface_total   surface_covered price           currency       
##  [9] title           property_type   operation_type  lat            
## [13] lon            
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<p>El resultado es 0 porque un registro no puede pertenecer a ambas comunas al mismo tiempo, sin embargo si queremos filtrar aquellos que pertenecen a una u otra podemos hacerlo así:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>filtro &lt;-<span class="st"> </span><span class="kw">filter</span>(datos_amba, partido<span class="op">==</span><span class="st">&quot;Comuna 5&quot;</span> <span class="op">|</span><span class="st"> </span>partido<span class="op">==</span><span class="st">&quot;Comuna 13&quot;</span>)</span>
<span id="cb37-2"><a href="#cb37-2"></a></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="kw">head</span>(filtro)</span></code></pre></div>
<pre><code>##   created_on provincia   partido rooms surface_total surface_covered price
## 1     202006      CABA Comuna 13     1            30              30 18000
## 2     202006      CABA Comuna 13     1            31              29 17900
## 3     202006      CABA Comuna 13     2            60              50 32000
## 4     202006      CABA Comuna 13     2            53              44 26000
## 5     202006      CABA  Comuna 5     2            45              38 20000
## 6     202006      CABA Comuna 13     2            55              55 45000
##   currency                                                           title
## 1      ARS           Retasado! Monoambiente en Nuñez, excelente ubicación!
## 2      ARS                                         Departamento - Belgrano
## 3      ARS Depto 2AMB c/ Suite y Toilette  - Deheza 1600 - Incluye Cochera
## 4      ARS       Unico 2 ambientes A Estrenar! Posesion inmediata! - Nuñez
## 5      ARS              Departamento de 2 ambientes en Alquiler en Almagro
## 6      ARS                              BLANCO ENCALADA AL 3000 A ESTRENAR
##   property_type operation_type       lat       lon
## 1  Departamento       Alquiler -34.55460 -58.46652
## 2  Departamento       Alquiler -34.56318 -58.46461
## 3  Departamento       Alquiler -34.53795 -58.46671
## 4  Departamento       Alquiler -34.54756 -58.47037
## 5  Departamento       Alquiler -34.60613 -58.42947
## 6  Departamento       Alquiler -34.56313 -58.46550</code></pre>
<p>También podemos quedarnos con aquellas propiedades que estén en alquiler y que tengan más de 50m2:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>filtro &lt;-<span class="st"> </span><span class="kw">filter</span>(datos_amba, operation_type<span class="op">==</span><span class="st">&quot;Alquiler&quot;</span> <span class="op">&amp;</span><span class="st"> </span>surface_covered<span class="op">&gt;=</span><span class="dv">50</span>)</span>
<span id="cb39-2"><a href="#cb39-2"></a></span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="kw">head</span>(filtro)</span></code></pre></div>
<pre><code>##   created_on provincia   partido rooms surface_total surface_covered price
## 1     202006      CABA Comuna 13     2            60              50 32000
## 2     202006      CABA Comuna 13     2            55              55 45000
## 3     202006       GBA  La Plata     2            50              50 18000
## 4     202006       GBA Ituzaingó     3            75              75 19000
## 5     202006       GBA     Tigre     3            95              80 42000
## 6     202006       GBA     Tigre     3            98              90 42000
##   currency
## 1      ARS
## 2      ARS
## 3      ARS
## 4      ARS
## 5      ARS
## 6      ARS
##                                                                                              title
## 1                                  Depto 2AMB c/ Suite y Toilette  - Deheza 1600 - Incluye Cochera
## 2                                                               BLANCO ENCALADA AL 3000 A ESTRENAR
## 3                                      Alquiler, depto de un domitorio frente al parque San Martin
## 4                                            Americana a 6 cuadras de la estacion de S.A. de Padua
## 5                                   3 AMBIENTES EN EDIFICIO MIRADORES DE LA BAHIA CON COCHERA FIJA
## 6 ¡EN EXCLUSIVA! Departamento en alquiler de 3 ambientes Miradores de La Bahía, Bahía de Nordelta.
##   property_type operation_type       lat       lon
## 1  Departamento       Alquiler -34.53795 -58.46671
## 2  Departamento       Alquiler -34.56313 -58.46550
## 3  Departamento       Alquiler -34.93415 -57.96605
## 4          Casa       Alquiler -34.65957 -58.69712
## 5  Departamento       Alquiler -34.39642 -58.64665
## 6  Departamento       Alquiler -34.39512 -58.64665</code></pre>
<p>O con aquellas propiedades que se ubiquen en la Comuna 12, 13 o 14 y que no sean monoambientes:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>filtro &lt;-<span class="st"> </span><span class="kw">filter</span>(datos_amba, partido <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Comuna 14&quot;</span>, <span class="st">&quot;Comuna 13&quot;</span>, <span class="st">&quot;Comuna 12&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="st"> </span>rooms<span class="op">==</span><span class="dv">1</span>)</span>
<span id="cb41-2"><a href="#cb41-2"></a></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="kw">head</span>(filtro)</span></code></pre></div>
<pre><code>##   created_on provincia   partido rooms surface_total surface_covered price
## 1     202006      CABA Comuna 13     2            60              50 32000
## 2     202006      CABA Comuna 13     2            53              44 26000
## 3     202006      CABA Comuna 12     2            42              37 22000
## 4     202006      CABA Comuna 14     2            43              33 27000
## 5     202006      CABA Comuna 13     2            55              55 45000
## 6     202006      CABA Comuna 14     2            48              48 23000
##   currency                                                           title
## 1      ARS Depto 2AMB c/ Suite y Toilette  - Deheza 1600 - Incluye Cochera
## 2      ARS       Unico 2 ambientes A Estrenar! Posesion inmediata! - Nuñez
## 3      ARS                         Depto 2AMB - Av. Balbin 3400 - ALQUILER
## 4      ARS                     Dos ambientes con Balcón a Demaría y Patio.
## 5      ARS                              BLANCO ENCALADA AL 3000 A ESTRENAR
## 6      ARS                                         Departamento - Belgrano
##   property_type operation_type       lat       lon
## 1  Departamento       Alquiler -34.53795 -58.46671
## 2  Departamento       Alquiler -34.54756 -58.47037
## 3  Departamento       Alquiler -34.55700 -58.47898
## 4  Departamento       Alquiler -34.57421 -58.42243
## 5  Departamento       Alquiler -34.56313 -58.46550
## 6  Departamento       Alquiler -34.56456 -58.43559</code></pre>
<p>¡Y así se pueden hacer todas las combinaciones de filtros que querramos!</p>
<p>¿Y si en vez de quitar filas queremos quitar columnas? Bueno, aquí tenemos que usar la función de “seleccionar” que veremos a continuación.</p>
</div>
<div id="seleccionar" class="section level2">
<h2><span class="header-section-number">2.2</span> Seleccionar</h2>
<p>La función <code>select()</code> nos permite elegir u ordenar columnas de nuestro dataset. Esto se puede hacer indicando los nombres completos de las columnas, palabras que contienen, o la letra con la que empiezan o terminan.</p>
<p>Graficamente sería algo así:</p>
<p><img src="images/tidyverse_seleccionar.jpg" /></p>
<p>Por ejemplo, de la siguiente forma podríamos quedarnos solo con las columnas created_on, provincia, price y currency:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">select</span>(datos_amba, created_on, provincia, price, currency)</span>
<span id="cb43-2"><a href="#cb43-2"></a></span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   created_on provincia price currency
## 1     202006      CABA 22500      ARS
## 2     202006      CABA 18000      ARS
## 3     202006      CABA 17900      ARS
## 4     202006      CABA 42000      ARS
## 5     202006       GBA 19000      ARS
## 6     202006       GBA 12000      ARS</code></pre>
<p>También podríamos elegir que columna/s no queremos tener más en nuestro dataset agregando un “-” antes de su nombre:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">select</span>(datos_amba, <span class="op">-</span>title)</span>
<span id="cb45-2"><a href="#cb45-2"></a></span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   created_on provincia       partido rooms surface_total surface_covered
## 1     202006      CABA      Comuna 7     1            40              37
## 2     202006      CABA     Comuna 13     1            30              30
## 3     202006      CABA     Comuna 13     1            31              29
## 4     202006      CABA      Comuna 1     1            35              35
## 5     202006       GBA Vicente López     1            36              27
## 6     202006       GBA    La Matanza     2            24              24
##   price currency property_type operation_type       lat       lon
## 1 22500      ARS  Departamento       Alquiler -34.61917 -58.46222
## 2 18000      ARS  Departamento       Alquiler -34.55460 -58.46652
## 3 17900      ARS  Departamento       Alquiler -34.56318 -58.46461
## 4 42000      ARS  Departamento       Alquiler -34.61836 -58.36090
## 5 19000      ARS  Departamento       Alquiler -34.53344 -58.49345
## 6 12000      ARS            PH       Alquiler -34.66253 -58.52914</code></pre>
<p>Con “:” podríamos indicar que queremos seleccionar un rango de columnas. Desde price hasta operation_type:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">select</span>(datos_amba, price<span class="op">:</span>operation_type)</span>
<span id="cb47-2"><a href="#cb47-2"></a></span>
<span id="cb47-3"><a href="#cb47-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   price currency
## 1 22500      ARS
## 2 18000      ARS
## 3 17900      ARS
## 4 42000      ARS
## 5 19000      ARS
## 6 12000      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type operation_type
## 1  Departamento       Alquiler
## 2  Departamento       Alquiler
## 3  Departamento       Alquiler
## 4  Departamento       Alquiler
## 5  Departamento       Alquiler
## 6            PH       Alquiler</code></pre>
<p>O con las que ocupan de la posición 7 a la 10:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">select</span>(datos_amba, <span class="dv">7</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb49-2"><a href="#cb49-2"></a></span>
<span id="cb49-3"><a href="#cb49-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   price currency
## 1 22500      ARS
## 2 18000      ARS
## 3 17900      ARS
## 4 42000      ARS
## 5 19000      ARS
## 6 12000      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type
## 1  Departamento
## 2  Departamento
## 3  Departamento
## 4  Departamento
## 5  Departamento
## 6            PH</code></pre>
<p>O agregando un “-” adelante podríamos quedarnos con aquellas que no ocupan de la posición 7 a 10:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">select</span>(datos_amba, <span class="op">-</span>(<span class="dv">7</span><span class="op">:</span><span class="dv">10</span>))</span>
<span id="cb51-2"><a href="#cb51-2"></a></span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   created_on provincia       partido rooms surface_total surface_covered
## 1     202006      CABA      Comuna 7     1            40              37
## 2     202006      CABA     Comuna 13     1            30              30
## 3     202006      CABA     Comuna 13     1            31              29
## 4     202006      CABA      Comuna 1     1            35              35
## 5     202006       GBA Vicente López     1            36              27
## 6     202006       GBA    La Matanza     2            24              24
##   operation_type       lat       lon
## 1       Alquiler -34.61917 -58.46222
## 2       Alquiler -34.55460 -58.46652
## 3       Alquiler -34.56318 -58.46461
## 4       Alquiler -34.61836 -58.36090
## 5       Alquiler -34.53344 -58.49345
## 6       Alquiler -34.66253 -58.52914</code></pre>
<p>Otra opción es seleccionar columnas de acuerdo a la primer letra de los nombres. Por ejemplo aquellas que comienzan con la letra “p”:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">select</span>(datos_amba, <span class="kw">starts_with</span>(<span class="st">&quot;p&quot;</span>))</span>
<span id="cb53-2"><a href="#cb53-2"></a></span>
<span id="cb53-3"><a href="#cb53-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   provincia       partido price property_type
## 1      CABA      Comuna 7 22500  Departamento
## 2      CABA     Comuna 13 18000  Departamento
## 3      CABA     Comuna 13 17900  Departamento
## 4      CABA      Comuna 1 42000  Departamento
## 5       GBA Vicente López 19000  Departamento
## 6       GBA    La Matanza 12000            PH</code></pre>
<p>O aquellas que sus nombres terminan con la letra “e”:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">select</span>(datos_amba, <span class="kw">ends_with</span>(<span class="st">&quot;e&quot;</span>))</span>
<span id="cb55-2"><a href="#cb55-2"></a></span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   price
## 1 22500
## 2 18000
## 3 17900
## 4 42000
## 5 19000
## 6 12000
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type operation_type
## 1  Departamento       Alquiler
## 2  Departamento       Alquiler
## 3  Departamento       Alquiler
## 4  Departamento       Alquiler
## 5  Departamento       Alquiler
## 6            PH       Alquiler</code></pre>
<p>O que sus nombres contengan la palabra “surface”:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">select</span>(datos_amba, <span class="kw">contains</span>(<span class="st">&quot;surface&quot;</span>))</span>
<span id="cb57-2"><a href="#cb57-2"></a></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   surface_total surface_covered
## 1            40              37
## 2            30              30
## 3            31              29
## 4            35              35
## 5            36              27
## 6            24              24</code></pre>
</div>
<div id="modificar" class="section level2">
<h2><span class="header-section-number">2.3</span> Modificar</h2>
<p>Ahora veamos como mutar nuestro dataset agregando nuevas columnas o cambiando el contenido de las existentes. Gráficamente sería algo así:</p>
<p><img src="images/tidyverse_modificar.jpg" /></p>
<p>Aprovechando que tenemos los datos del precio total (price) y superficie cubierta (surface_covered) de cada una de las propiedades, agreguemos una nueva columna a nuestro dataset que incluya el valor del m2:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>modificar &lt;-<span class="st"> </span><span class="kw">mutate</span>(datos_amba, <span class="dt">price_m2=</span>price<span class="op">/</span>surface_covered)</span>
<span id="cb59-2"><a href="#cb59-2"></a></span>
<span id="cb59-3"><a href="#cb59-3"></a><span class="kw">head</span>(modificar)</span></code></pre></div>
<pre><code>##   created_on provincia       partido rooms surface_total surface_covered
## 1     202006      CABA      Comuna 7     1            40              37
## 2     202006      CABA     Comuna 13     1            30              30
## 3     202006      CABA     Comuna 13     1            31              29
## 4     202006      CABA      Comuna 1     1            35              35
## 5     202006       GBA Vicente López     1            36              27
## 6     202006       GBA    La Matanza     2            24              24
##   price currency
## 1 22500      ARS
## 2 18000      ARS
## 3 17900      ARS
## 4 42000      ARS
## 5 19000      ARS
## 6 12000      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type operation_type       lat       lon  price_m2
## 1  Departamento       Alquiler -34.61917 -58.46222  608.1081
## 2  Departamento       Alquiler -34.55460 -58.46652  600.0000
## 3  Departamento       Alquiler -34.56318 -58.46461  617.2414
## 4  Departamento       Alquiler -34.61836 -58.36090 1200.0000
## 5  Departamento       Alquiler -34.53344 -58.49345  703.7037
## 6            PH       Alquiler -34.66253 -58.52914  500.0000</code></pre>
<p>Si queremos redondear el resultado obtenido, principalmente cuando es una división y por default nos pone varios decimales, tenemos que usar <code>round()</code> y asignar la cantidad de decimales deseados, en este caso usaré 2:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>modificar &lt;-<span class="st"> </span><span class="kw">mutate</span>(datos_amba, <span class="dt">price_m2=</span><span class="kw">round</span>(price<span class="op">/</span>surface_covered, <span class="dv">2</span>))</span>
<span id="cb61-2"><a href="#cb61-2"></a></span>
<span id="cb61-3"><a href="#cb61-3"></a><span class="kw">head</span>(modificar)</span></code></pre></div>
<pre><code>##   created_on provincia       partido rooms surface_total surface_covered
## 1     202006      CABA      Comuna 7     1            40              37
## 2     202006      CABA     Comuna 13     1            30              30
## 3     202006      CABA     Comuna 13     1            31              29
## 4     202006      CABA      Comuna 1     1            35              35
## 5     202006       GBA Vicente López     1            36              27
## 6     202006       GBA    La Matanza     2            24              24
##   price currency
## 1 22500      ARS
## 2 18000      ARS
## 3 17900      ARS
## 4 42000      ARS
## 5 19000      ARS
## 6 12000      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type operation_type       lat       lon price_m2
## 1  Departamento       Alquiler -34.61917 -58.46222   608.11
## 2  Departamento       Alquiler -34.55460 -58.46652   600.00
## 3  Departamento       Alquiler -34.56318 -58.46461   617.24
## 4  Departamento       Alquiler -34.61836 -58.36090  1200.00
## 5  Departamento       Alquiler -34.53344 -58.49345   703.70
## 6            PH       Alquiler -34.66253 -58.52914   500.00</code></pre>
<p>Como verán, para hacer cálculos entre columnas numéricas podemos utilizar:</p>
<ul>
<li><strong>A/B</strong> A dividido B</li>
<li>**A*B** A multiplicado por B</li>
<li><strong>A+B</strong> Suma de A y B</li>
<li><strong>A-B</strong> Resta de A menos B</li>
</ul>
<p>También podríamos agregar una columna que refleje un cálculo entre una columna existente y un valor extra, por ejemplo pasemos la superficie total de m2 a cm2:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>modificar &lt;-<span class="st"> </span><span class="kw">mutate</span>(datos_amba, <span class="dt">surface_total_cm2=</span>surface_total<span class="op">*</span><span class="dv">10000</span>)</span>
<span id="cb63-2"><a href="#cb63-2"></a></span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="kw">head</span>(modificar)</span></code></pre></div>
<pre><code>##   created_on provincia       partido rooms surface_total surface_covered
## 1     202006      CABA      Comuna 7     1            40              37
## 2     202006      CABA     Comuna 13     1            30              30
## 3     202006      CABA     Comuna 13     1            31              29
## 4     202006      CABA      Comuna 1     1            35              35
## 5     202006       GBA Vicente López     1            36              27
## 6     202006       GBA    La Matanza     2            24              24
##   price currency
## 1 22500      ARS
## 2 18000      ARS
## 3 17900      ARS
## 4 42000      ARS
## 5 19000      ARS
## 6 12000      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type operation_type       lat       lon surface_total_cm2
## 1  Departamento       Alquiler -34.61917 -58.46222            400000
## 2  Departamento       Alquiler -34.55460 -58.46652            300000
## 3  Departamento       Alquiler -34.56318 -58.46461            310000
## 4  Departamento       Alquiler -34.61836 -58.36090            350000
## 5  Departamento       Alquiler -34.53344 -58.49345            360000
## 6            PH       Alquiler -34.66253 -58.52914            240000</code></pre>
<p>Dejando de lado los cálculos, otra posibilidad que tenemos es separar el contenido de una columna en 2, por ejemplo dividamos en año y mes la data que aparece en created_on. Para esto utilizaremos <code>substr()</code>:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>modificar &lt;-<span class="st"> </span><span class="kw">mutate</span>(datos_amba,</span>
<span id="cb65-2"><a href="#cb65-2"></a>                    <span class="dt">year =</span> <span class="kw">substr</span>(created_on, <span class="dv">1</span>, <span class="dv">4</span>),</span>
<span id="cb65-3"><a href="#cb65-3"></a>                    <span class="dt">month =</span> <span class="kw">substr</span>(created_on, <span class="dv">5</span>, <span class="dv">6</span>))</span>
<span id="cb65-4"><a href="#cb65-4"></a></span>
<span id="cb65-5"><a href="#cb65-5"></a><span class="kw">head</span>(modificar)</span></code></pre></div>
<pre><code>##   created_on provincia       partido rooms surface_total surface_covered
## 1     202006      CABA      Comuna 7     1            40              37
## 2     202006      CABA     Comuna 13     1            30              30
## 3     202006      CABA     Comuna 13     1            31              29
## 4     202006      CABA      Comuna 1     1            35              35
## 5     202006       GBA Vicente López     1            36              27
## 6     202006       GBA    La Matanza     2            24              24
##   price currency
## 1 22500      ARS
## 2 18000      ARS
## 3 17900      ARS
## 4 42000      ARS
## 5 19000      ARS
## 6 12000      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type operation_type       lat       lon year month
## 1  Departamento       Alquiler -34.61917 -58.46222 2020    06
## 2  Departamento       Alquiler -34.55460 -58.46652 2020    06
## 3  Departamento       Alquiler -34.56318 -58.46461 2020    06
## 4  Departamento       Alquiler -34.61836 -58.36090 2020    06
## 5  Departamento       Alquiler -34.53344 -58.49345 2020    06
## 6            PH       Alquiler -34.66253 -58.52914 2020    06</code></pre>
<p>Otra aplicación que tiene <code>mutate()</code> es la de agregar columnas con algun contenido que elijamos nosotros, como por ejemplo sumemos una nueva columna que indique la fuente de donde descargamos toda esta información:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>modificar &lt;-<span class="st"> </span><span class="kw">mutate</span>(datos_amba, <span class="dt">fuente=</span><span class="st">&quot;Properati&quot;</span>)</span>
<span id="cb67-2"><a href="#cb67-2"></a></span>
<span id="cb67-3"><a href="#cb67-3"></a><span class="kw">head</span>(modificar)</span></code></pre></div>
<pre><code>##   created_on provincia       partido rooms surface_total surface_covered
## 1     202006      CABA      Comuna 7     1            40              37
## 2     202006      CABA     Comuna 13     1            30              30
## 3     202006      CABA     Comuna 13     1            31              29
## 4     202006      CABA      Comuna 1     1            35              35
## 5     202006       GBA Vicente López     1            36              27
## 6     202006       GBA    La Matanza     2            24              24
##   price currency
## 1 22500      ARS
## 2 18000      ARS
## 3 17900      ARS
## 4 42000      ARS
## 5 19000      ARS
## 6 12000      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type operation_type       lat       lon    fuente
## 1  Departamento       Alquiler -34.61917 -58.46222 Properati
## 2  Departamento       Alquiler -34.55460 -58.46652 Properati
## 3  Departamento       Alquiler -34.56318 -58.46461 Properati
## 4  Departamento       Alquiler -34.61836 -58.36090 Properati
## 5  Departamento       Alquiler -34.53344 -58.49345 Properati
## 6            PH       Alquiler -34.66253 -58.52914 Properati</code></pre>
<p>Ahora veamos como modificar el tipo de dato dentro de una columna:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="kw">class</span>(datos_amba<span class="op">$</span>title)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<p>Vemos que la variable “title” es de tipo factor, así que cambiemos su formato a character:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>modificar &lt;-<span class="st"> </span><span class="kw">mutate</span>(datos_amba, <span class="dt">title=</span><span class="kw">as.character</span>(title))</span>
<span id="cb71-2"><a href="#cb71-2"></a></span>
<span id="cb71-3"><a href="#cb71-3"></a><span class="kw">class</span>(modificar<span class="op">$</span>title)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>En el ejemplo anterior utilizamos <code>as.character()</code> pero si quisiesemos convertir una variable a factor utilizariamos <code>as.factor()</code>, a numérica <code>as.numeric()</code> o a número entero <code>as.integer()</code>,</p>
<p>Por último, veamos como unir 2 columnas de texto en una con <code>paste()</code>:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a>modificar &lt;-<span class="st"> </span><span class="kw">mutate</span>(datos_amba, <span class="dt">prov_partido=</span><span class="kw">paste</span>(provincia, partido, <span class="dt">sep=</span><span class="st">&quot;_&quot;</span>))</span>
<span id="cb73-2"><a href="#cb73-2"></a></span>
<span id="cb73-3"><a href="#cb73-3"></a><span class="kw">head</span>(modificar)</span></code></pre></div>
<pre><code>##   created_on provincia       partido rooms surface_total surface_covered
## 1     202006      CABA      Comuna 7     1            40              37
## 2     202006      CABA     Comuna 13     1            30              30
## 3     202006      CABA     Comuna 13     1            31              29
## 4     202006      CABA      Comuna 1     1            35              35
## 5     202006       GBA Vicente López     1            36              27
## 6     202006       GBA    La Matanza     2            24              24
##   price currency
## 1 22500      ARS
## 2 18000      ARS
## 3 17900      ARS
## 4 42000      ARS
## 5 19000      ARS
## 6 12000      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type operation_type       lat       lon      prov_partido
## 1  Departamento       Alquiler -34.61917 -58.46222     CABA_Comuna 7
## 2  Departamento       Alquiler -34.55460 -58.46652    CABA_Comuna 13
## 3  Departamento       Alquiler -34.56318 -58.46461    CABA_Comuna 13
## 4  Departamento       Alquiler -34.61836 -58.36090     CABA_Comuna 1
## 5  Departamento       Alquiler -34.53344 -58.49345 GBA_Vicente López
## 6            PH       Alquiler -34.66253 -58.52914    GBA_La Matanza</code></pre>
</div>
<div id="ordenar" class="section level2">
<h2><span class="header-section-number">2.4</span> Ordenar</h2>
<p>Esta función nos permitirá ordenar las columnas en orden ascendente o descendente como se ve a continuación:</p>
<p><img src="images/tidyverse_ordenar.jpg" /></p>
<p>Probemos ordenar las filas de nuestro data frame en función de los valores de una o más columnas. Por defecto se ordena en forma ascendente:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a>ordenar &lt;-<span class="st"> </span><span class="kw">arrange</span>(datos_amba, surface_total)</span>
<span id="cb75-2"><a href="#cb75-2"></a></span>
<span id="cb75-3"><a href="#cb75-3"></a><span class="kw">head</span>(ordenar)</span></code></pre></div>
<pre><code>##   created_on provincia   partido rooms surface_total surface_covered price
## 1     202007      CABA Comuna 15     1            10              10 25000
## 2     202006       GBA     Tigre     2            12              12 10500
## 3     202007      CABA  Comuna 1     1            14              14 35000
## 4     202006      CABA  Comuna 2     1            15              15 12900
## 5     202007      CABA Comuna 15     1            18              18 48000
## 6     202006       GBA     Morón     1            18              17 35000
##   currency
## 1      USD
## 2      ARS
## 3      USD
## 4      ARS
## 5      USD
## 6      USD
##                                                                      title
## 1                             Garage - Cochera Descubierta en Villa Crespo
## 2                    Departamento de 2 ambientes en Pradera, Santa Barbara
## 3                                   VENTA PH 13,84 M2 PANTA BAJA BALVANERA
## 4                                 Departamento en Alquiler en Barrio Norte
## 5                       Venta Monoambiente estudio con amenities Chacarita
## 6 Lindo monoambiente en 2do piso por escalera al frente. BAJAS EXPENSAS!!!
##   property_type operation_type       lat       lon
## 1  Departamento          Venta -34.60330 -58.45547
## 2  Departamento       Alquiler -34.44604 -58.63236
## 3            PH          Venta -34.61566 -58.39221
## 4  Departamento       Alquiler -34.59092 -58.40632
## 5  Departamento          Venta -34.59043 -58.44666
## 6  Departamento          Venta -34.64390 -58.63221</code></pre>
<p>Pero si queremos ordenar en forma descendente debemos aclararlo con <code>desc()</code>:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>ordenar &lt;-<span class="st"> </span><span class="kw">arrange</span>(datos_amba, <span class="kw">desc</span>(surface_total))</span>
<span id="cb77-2"><a href="#cb77-2"></a></span>
<span id="cb77-3"><a href="#cb77-3"></a><span class="kw">head</span>(ordenar)</span></code></pre></div>
<pre><code>##   created_on provincia     partido rooms surface_total surface_covered
## 1     202007       GBA       Pilar     5          5000             300
## 2     202006       GBA San Vicente     3          4356             150
## 3     202007       GBA       Pilar     6          3780             320
## 4     202006      CABA   Comuna 13     2          3650              35
## 5     202007       GBA       Luján     4          2703             182
## 6     202007       GBA       Pilar     3          2500              70
##    price currency
## 1 120000      USD
## 2  85000      USD
## 3 220000      USD
## 4 109500      USD
## 5 370000      USD
## 6 121000      USD
##                                                           title
## 1                                          Venta de Casa Quinta
## 2 España entre Buchard y Esmeralda. Casa en venta, San Viciente
## 3            Venta casaquinta Del Viso Residencial Los Jazmines
## 4            Acogedor Departamento de dos ambientes en Belgrano
## 5                Casa 3 dormitorios estilo campo Estancias Golf
## 6              VENTA CASA 2 AMBIENTES PILAR 2500 M2 DE PARQUE!!
##   property_type operation_type       lat       lon
## 1          Casa          Venta -34.40066 -58.86919
## 2          Casa          Venta -35.02984 -58.40594
## 3          Casa          Venta -34.45687 -58.79651
## 4  Departamento          Venta -34.55398 -58.44853
## 5          Casa          Venta -34.49543 -59.00930
## 6          Casa          Venta -34.41586 -58.85729</code></pre>
<p>También podemos ordenar por 2 o más columnas. En este caso, R priorizará ordenar la primera, luego la segunda, y asi sucesivamente. Veamos un ejemplo:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a>ordenar &lt;-<span class="st"> </span><span class="kw">arrange</span>(datos_amba, partido, rooms)</span>
<span id="cb79-2"><a href="#cb79-2"></a></span>
<span id="cb79-3"><a href="#cb79-3"></a><span class="kw">head</span>(ordenar)</span></code></pre></div>
<pre><code>##   created_on provincia         partido rooms surface_total surface_covered
## 1     202006       GBA Almirante Brown     2            40              40
## 2     202006       GBA Almirante Brown     2            60              60
## 3     202006       GBA Almirante Brown     2            50              50
## 4     202007       GBA Almirante Brown     2            52              48
## 5     202007       GBA Almirante Brown     2            47              47
## 6     202007       GBA Almirante Brown     2            50              50
##    price currency
## 1  14500      ARS
## 2  20000      ARS
## 3 125000      USD
## 4  18000      ARS
## 5  16000      ARS
## 6  96000      USD
##                                                                                      title
## 1                                                                 Departamento en alquiler
## 2                                                                   Departamento - Adrogue
## 3                                                                   Departamento - Adrogue
## 4 Venta de Departamento 2 ambientes en Hermoso Edificio a metros de Plaza Brown de Adrogué
## 5                                             DEPARTAMENTO 2 AMBIENTES EN AV ESPORA AL 800
## 6                                                                   Departamento - Adrogue
##   property_type operation_type       lat       lon
## 1  Departamento       Alquiler -34.81144 -58.39264
## 2  Departamento       Alquiler -34.79964 -58.38278
## 3  Departamento          Venta -34.79732 -58.39132
## 4  Departamento       Alquiler -34.79720 -58.38280
## 5  Departamento       Alquiler -34.79880 -58.38863
## 6  Departamento          Venta -34.79913 -58.38364</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>ordenar &lt;-<span class="st"> </span><span class="kw">arrange</span>(datos_amba, partido, <span class="kw">desc</span>(rooms))</span>
<span id="cb81-2"><a href="#cb81-2"></a></span>
<span id="cb81-3"><a href="#cb81-3"></a><span class="kw">head</span>(ordenar)</span></code></pre></div>
<pre><code>##   created_on provincia         partido rooms surface_total surface_covered
## 1     202007       GBA Almirante Brown     8           447             189
## 2     202006       GBA Almirante Brown     7           670             590
## 3     202006       GBA Almirante Brown     5           239             112
## 4     202006       GBA Almirante Brown     5           260             120
## 5     202007       GBA Almirante Brown     5           370             220
## 6     202006       GBA Almirante Brown     5           180             180
##     price currency
## 1  230000      USD
## 2 1500000      USD
## 3  169000      USD
## 4  248000      USD
## 5  230000      USD
## 6  390000      USD
##                                                                                        title
## 1                                         Casa c/2 dptos, local y galpón - Lomas del Mirador
## 2                                                                             Casa - Adrogue
## 3 A REFACCIONAR! Casona colonial con gran lote, fondo libre, parrilla, 3 dormitorios 2 baños
## 4                                         Hermoso Duplex 3 dormitorios gran patio 4 cocheras
## 5                                            Chalet en venta Barrio Santa Rita -  Longchamps
## 6                        Casa en Construccion en Venta en Barrio Privado &#39;Brisas de Adrogue&#39;
##   property_type operation_type       lat       lon
## 1          Casa          Venta -34.86568 -58.37823
## 2          Casa          Venta -34.80905 -58.40631
## 3            PH          Venta -34.79638 -58.38691
## 4          Casa          Venta -34.79746 -58.37885
## 5          Casa          Venta -34.86473 -58.39129
## 6          Casa          Venta -34.81368 -58.40300</code></pre>
</div>
<div id="renombrar" class="section level2">
<h2><span class="header-section-number">2.5</span> Renombrar</h2>
<p>Ahora veamos como cambiar los nombres a una o más columnas existentes en nuestro dataset:</p>
<p><img src="images/tidyverse_renombrar.jpg" /></p>
<p>Empecemos cambiando el nombre de la variable “rooms” por “ambientes”:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a>renombrar &lt;-<span class="st"> </span><span class="kw">rename</span>(datos_amba, <span class="dt">ambientes=</span>rooms)</span>
<span id="cb83-2"><a href="#cb83-2"></a></span>
<span id="cb83-3"><a href="#cb83-3"></a><span class="kw">head</span>(renombrar)</span></code></pre></div>
<pre><code>##   created_on provincia       partido ambientes surface_total
## 1     202006      CABA      Comuna 7         1            40
## 2     202006      CABA     Comuna 13         1            30
## 3     202006      CABA     Comuna 13         1            31
## 4     202006      CABA      Comuna 1         1            35
## 5     202006       GBA Vicente López         1            36
## 6     202006       GBA    La Matanza         2            24
##   surface_covered price currency
## 1              37 22500      ARS
## 2              30 18000      ARS
## 3              29 17900      ARS
## 4              35 42000      ARS
## 5              27 19000      ARS
## 6              24 12000      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type operation_type       lat       lon
## 1  Departamento       Alquiler -34.61917 -58.46222
## 2  Departamento       Alquiler -34.55460 -58.46652
## 3  Departamento       Alquiler -34.56318 -58.46461
## 4  Departamento       Alquiler -34.61836 -58.36090
## 5  Departamento       Alquiler -34.53344 -58.49345
## 6            PH       Alquiler -34.66253 -58.52914</code></pre>
<p>Como habrán notado, primero hay que poner el nombre de la nueva columna y luego el de la columna actual. Esto es muy importante, porque si lo hacemos al revés nos dará un error.</p>
<p>Ahora veamos un ejemplo y cambiemos los nombres de 3 columnas:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a>renombrar &lt;-<span class="st"> </span><span class="kw">rename</span>(datos_amba, <span class="dt">ambientes=</span>rooms, <span class="dt">m2_cubierto=</span>surface_covered, <span class="dt">m2_total=</span>surface_total)</span>
<span id="cb85-2"><a href="#cb85-2"></a></span>
<span id="cb85-3"><a href="#cb85-3"></a><span class="kw">head</span>(renombrar)</span></code></pre></div>
<pre><code>##   created_on provincia       partido ambientes m2_total m2_cubierto price
## 1     202006      CABA      Comuna 7         1       40          37 22500
## 2     202006      CABA     Comuna 13         1       30          30 18000
## 3     202006      CABA     Comuna 13         1       31          29 17900
## 4     202006      CABA      Comuna 1         1       35          35 42000
## 5     202006       GBA Vicente López         1       36          27 19000
## 6     202006       GBA    La Matanza         2       24          24 12000
##   currency
## 1      ARS
## 2      ARS
## 3      ARS
## 4      ARS
## 5      ARS
## 6      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type operation_type       lat       lon
## 1  Departamento       Alquiler -34.61917 -58.46222
## 2  Departamento       Alquiler -34.55460 -58.46652
## 3  Departamento       Alquiler -34.56318 -58.46461
## 4  Departamento       Alquiler -34.61836 -58.36090
## 5  Departamento       Alquiler -34.53344 -58.49345
## 6            PH       Alquiler -34.66253 -58.52914</code></pre>
</div>
<div id="resumir-y-agrupar" class="section level2">
<h2><span class="header-section-number">2.6</span> Resumir y Agrupar</h2>
<p>Esta función es súper útil cuando manipulamos datos ya que nos permitirá realizar resumenes/sumarios de la data completa, obteniendo por ejemplo valores promedio, máximos o mínimos de una o más columnas.</p>
<p><img src="images/tidyverse_agrupar.jpg" /></p>
<p>Probemos calculando la mediana de todos los valores que aparecen en la columna surface_covered:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="kw">summarise</span>(datos_amba, <span class="dt">surface_covered=</span><span class="kw">median</span>(surface_covered))</span></code></pre></div>
<pre><code>##   surface_covered
## 1              66</code></pre>
<p>O calculemos un promedio de toda la columna surface_total:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="kw">summarise</span>(datos_amba, <span class="dt">surface_covered=</span><span class="kw">mean</span>(surface_covered))</span></code></pre></div>
<pre><code>##   surface_covered
## 1        91.98151</code></pre>
<p>También podemos averiguar el valor máximo o mínimo de alguna variable:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="kw">summarise</span>(datos_amba, <span class="dt">surface_covered=</span><span class="kw">max</span>(rooms))</span></code></pre></div>
<pre><code>##   surface_covered
## 1              10</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="kw">summarise</span>(datos_amba, <span class="dt">surface_covered=</span><span class="kw">min</span>(rooms))</span></code></pre></div>
<pre><code>##   surface_covered
## 1               1</code></pre>
<p>Como verán, esta función resulta útil para ver valores agregados de toda la base, sin embargo, también podemos agrupar los datos previo a calular los resumenes, y así obtener resumenes por agrupaciones en vez de uno solo para toda la base. Para esto vamos a utilizar <code>summarise()</code> junto a <code>group_by()</code>. Veamos un ejemplo:</p>
<ul>
<li><p>Primero agrupemos los datos por la variable “operation_type”.</p></li>
<li><p>Luego calculemos el promedio de superficie cubierta sobre la agrupación realizada previamente.</p></li>
</ul>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a>agrupar &lt;-<span class="st"> </span><span class="kw">group_by</span>(datos_amba, operation_type)</span>
<span id="cb95-2"><a href="#cb95-2"></a></span>
<span id="cb95-3"><a href="#cb95-3"></a>resumir &lt;-<span class="st"> </span><span class="kw">summarise</span>(agrupar, <span class="dt">surface_covered=</span><span class="kw">mean</span>(surface_covered))</span>
<span id="cb95-4"><a href="#cb95-4"></a></span>
<span id="cb95-5"><a href="#cb95-5"></a><span class="kw">head</span>(resumir)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   operation_type surface_covered
##   &lt;fct&gt;                    &lt;dbl&gt;
## 1 Alquiler                  72.9
## 2 Venta                     97.3</code></pre>
<p>Con la agrupación y el resumen podemos ver que la superficie cubierta promedio de las propiedades en alquiler es 72,93m2 y la de las propiedades en venta es 97,28m2.</p>
<p>Probemos agrupando por 3 columnas:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a>agrupar &lt;-<span class="st"> </span><span class="kw">group_by</span>(datos_amba, operation_type, currency)</span>
<span id="cb97-2"><a href="#cb97-2"></a></span>
<span id="cb97-3"><a href="#cb97-3"></a>resumir &lt;-<span class="st"> </span><span class="kw">summarise</span>(agrupar, <span class="dt">price_m2=</span><span class="kw">mean</span>(price<span class="op">/</span>surface_covered))</span>
<span id="cb97-4"><a href="#cb97-4"></a></span>
<span id="cb97-5"><a href="#cb97-5"></a><span class="kw">head</span>(resumir)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
## # Groups:   operation_type [2]
##   operation_type currency price_m2
##   &lt;fct&gt;          &lt;fct&gt;       &lt;dbl&gt;
## 1 Alquiler       ARS          520.
## 2 Venta          USD         2689.</code></pre>
<p>El valor del m2 promedio para las propiedades en Alquiler es de 520 $ARS mientras que para las propiedaes en venta es de 2.689 USD. Sin embargo, está claro que en el valor de CABA y GBA es diferente, así que calculemos el valor del m2 promedio para cada uno:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a>agrupar &lt;-<span class="st"> </span><span class="kw">group_by</span>(datos_amba, operation_type, currency, provincia)</span>
<span id="cb99-2"><a href="#cb99-2"></a></span>
<span id="cb99-3"><a href="#cb99-3"></a>resumir &lt;-<span class="st"> </span><span class="kw">summarise</span>(agrupar, <span class="dt">rooms=</span><span class="kw">mean</span>(price<span class="op">/</span>surface_covered))</span>
<span id="cb99-4"><a href="#cb99-4"></a></span>
<span id="cb99-5"><a href="#cb99-5"></a><span class="kw">head</span>(resumir)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
## # Groups:   operation_type, currency [2]
##   operation_type currency provincia rooms
##   &lt;fct&gt;          &lt;fct&gt;    &lt;fct&gt;     &lt;dbl&gt;
## 1 Alquiler       ARS      CABA       617.
## 2 Alquiler       ARS      GBA        399.
## 3 Venta          USD      CABA      3119.
## 4 Venta          USD      GBA       2024.</code></pre>
<p>Se ve claramente que hay una diferencia entre CABA y GBA, siendo CABA más caro para ambos tipos de operación. Por último probemos desagregando esta información por partido:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a>agrupar &lt;-<span class="st"> </span><span class="kw">group_by</span>(datos_amba, operation_type, currency, partido)</span>
<span id="cb101-2"><a href="#cb101-2"></a></span>
<span id="cb101-3"><a href="#cb101-3"></a>resumir &lt;-<span class="st"> </span><span class="kw">summarise</span>(agrupar, <span class="dt">price_m2=</span><span class="kw">mean</span>(price<span class="op">/</span>surface_covered))</span>
<span id="cb101-4"><a href="#cb101-4"></a></span>
<span id="cb101-5"><a href="#cb101-5"></a><span class="kw">head</span>(resumir)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
## # Groups:   operation_type, currency [1]
##   operation_type currency partido         price_m2
##   &lt;fct&gt;          &lt;fct&gt;    &lt;fct&gt;              &lt;dbl&gt;
## 1 Alquiler       ARS      Almirante Brown     304.
## 2 Alquiler       ARS      Avellaneda          299.
## 3 Alquiler       ARS      Berazategui         311.
## 4 Alquiler       ARS      Comuna 1            699.
## 5 Alquiler       ARS      Comuna 10           381.
## 6 Alquiler       ARS      Comuna 11           444.</code></pre>
</div>
<div id="concatenar-funciones" class="section level2">
<h2><span class="header-section-number">2.7</span> Concatenar funciones (%&gt;%)</h2>
<p>Llegamos al final de la clase, ya vimos varias funciones por separado, pero ¿Qué pasa si queremos aplicarlas todas a la vez? ¿Cómo podemos hacerlo?</p>
<p>En este caso debemos usar el operador pipe (%&gt;%) <strong>Ctrl+Shift+M</strong> que sirve para encadenar funciones, y en vez de realizar una por una, poder realizar todas juntas.</p>
<p>Veamos algunos ejemplos:</p>
<p>Imaginemos que queremos calcular por mes y para cada provincia (CABA y GBA) cuantas propiedades hubo en venta, con que valor total promedio, con que valor del m2 promedio y con que superficie promedio. Así lo tenemos que hacer según lo aprendido hasta ahora:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a>concatenar &lt;-<span class="st"> </span><span class="kw">filter</span>(datos_amba, operation_type<span class="op">==</span><span class="st">&quot;Venta&quot;</span>)</span>
<span id="cb103-2"><a href="#cb103-2"></a></span>
<span id="cb103-3"><a href="#cb103-3"></a>concatenar &lt;-<span class="st"> </span><span class="kw">select</span>(concatenar, created_on, provincia, surface_covered, price)</span>
<span id="cb103-4"><a href="#cb103-4"></a></span>
<span id="cb103-5"><a href="#cb103-5"></a>concatenar &lt;-<span class="st"> </span><span class="kw">group_by</span>(concatenar, created_on, provincia)</span>
<span id="cb103-6"><a href="#cb103-6"></a></span>
<span id="cb103-7"><a href="#cb103-7"></a>concatenar &lt;-<span class="st"> </span><span class="kw">summarise</span>(concatenar, <span class="dt">cantidad=</span><span class="kw">n</span>(),</span>
<span id="cb103-8"><a href="#cb103-8"></a>                        <span class="dt">price=</span><span class="kw">mean</span>(price),</span>
<span id="cb103-9"><a href="#cb103-9"></a>                        <span class="dt">surface_covered=</span><span class="kw">mean</span>(surface_covered),</span>
<span id="cb103-10"><a href="#cb103-10"></a>                        <span class="dt">price_m2=</span>price<span class="op">/</span>surface_covered)</span>
<span id="cb103-11"><a href="#cb103-11"></a></span>
<span id="cb103-12"><a href="#cb103-12"></a><span class="kw">head</span>(concatenar)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 6
## # Groups:   created_on [2]
##   created_on provincia cantidad   price surface_covered price_m2
##        &lt;int&gt; &lt;fct&gt;        &lt;int&gt;   &lt;dbl&gt;           &lt;dbl&gt;    &lt;dbl&gt;
## 1     202006 CABA          3986 291547.            85.3    3420.
## 2     202006 GBA           2772 231074.           121.     1903.
## 3     202007 CABA          3110 251563.            80.5    3124.
## 4     202007 GBA           1810 206180.           116.     1783.</code></pre>
<p>Y así lo deberíamos hacer con pipe %&gt;%:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a>concatenar &lt;-<span class="st"> </span>datos_amba <span class="op">%&gt;%</span></span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="st">  </span><span class="kw">filter</span>(operation_type<span class="op">==</span><span class="st">&quot;Venta&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb105-3"><a href="#cb105-3"></a><span class="st">  </span><span class="kw">select</span>(created_on, provincia, surface_covered, price) <span class="op">%&gt;%</span></span>
<span id="cb105-4"><a href="#cb105-4"></a><span class="st">  </span><span class="kw">group_by</span>(created_on, provincia) <span class="op">%&gt;%</span></span>
<span id="cb105-5"><a href="#cb105-5"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">cantidad=</span><span class="kw">n</span>(),</span>
<span id="cb105-6"><a href="#cb105-6"></a>            <span class="dt">price=</span><span class="kw">mean</span>(price),</span>
<span id="cb105-7"><a href="#cb105-7"></a>            <span class="dt">surface_covered=</span><span class="kw">mean</span>(surface_covered),</span>
<span id="cb105-8"><a href="#cb105-8"></a>            <span class="dt">price_m2=</span>price<span class="op">/</span>surface_covered)</span>
<span id="cb105-9"><a href="#cb105-9"></a></span>
<span id="cb105-10"><a href="#cb105-10"></a><span class="kw">head</span>(concatenar)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 6
## # Groups:   created_on [2]
##   created_on provincia cantidad   price surface_covered price_m2
##        &lt;int&gt; &lt;fct&gt;        &lt;int&gt;   &lt;dbl&gt;           &lt;dbl&gt;    &lt;dbl&gt;
## 1     202006 CABA          3986 291547.            85.3    3420.
## 2     202006 GBA           2772 231074.           121.     1903.
## 3     202007 CABA          3110 251563.            80.5    3124.
## 4     202007 GBA           1810 206180.           116.     1783.</code></pre>
<p>A partir de la agrupación y resumen por ejemplo podemos ver que:</p>
<ul>
<li>En ambos meses, en CABA hubo mayor cantidad de propiedades en venta.</li>
<li>En ambos meses, la superficie cubierta de las propiedades en venta en GBA son mayores que las de CABA.</li>
<li>En ambos meses el valor promedio del m2 es más alto en CABA que ne GBA.</li>
<li>En ambas zonas (CABA y GBA), entre Junio y Julio 2020 hubo una caída en la cantidad de propiedades publicadas y en el valor promedio del m2.</li>
</ul>
<p>Como verán, en ambos casos llegamos al mismo resultado, pero sin dudas, la segunda opción es la recomendable porque nos ahorramos varias líneas de código y resultados intermedios.</p>
<!--chapter:end:02-manipular.Rmd-->
</div>
</div>
<div id="graficar" class="section level1">
<h1><span class="header-section-number">3</span> GRAFICAR</h1>
<p>El paquete <code>tidyverse</code> incluye diversos paquetes, entre los que se encuentra <code>ggplot2</code>, que nos permite realizar diferentes tipos de gráficos a partir de nuestros datos.</p>
<p>Hasta acá ya sabemos abrir, conocer, manipular y transformar un dataset, así que ahora nos enfocaremos en el <strong>desarrollo de visualizaciones</strong> que nos permitirán comunicar de forma gráfica lo que dicen nuestros datos.</p>
<p>En la estructura del código necesario para realizar un gráfico con <code>ggplot2</code> hay que determinar lo siguiente:</p>
<ul>
<li><strong>Dataset a utilizar</strong>: hay que indicar el dataset al inicio del código en <strong>ggplot(dataset)</strong>.</li>
<li><strong>Tipo de Gráfico</strong> a realizar: puede ser de puntos, barras, líneas, áreas, matriz, histograma, densidad, etc. Estos elementos funcionan como “capas” ya que pueden utilizarse más de uno a la vez en un mismo gráfico y sus códigos se escriben <strong>geom_hist()</strong>, <strong>geom_tile()</strong>, <strong>geom_bar()</strong>, etc.</li>
<li><strong>Atributos Estéticos</strong> que dependen de una o más columnas del dataset: variables a utilizar en ejes x e y, colores, tamaños, formas, transparencias, etc. Siempre se asignan dentro de <strong>aes()</strong>.</li>
<li><strong>Etiquetas</strong> que ayudan a la interpretación de las visualizaciones. Estas son: títulos, subtítulos, leyendas, etc. Se asignan dentro de <strong>labs()</strong>.</li>
<li><strong>Facetas</strong> a utilizar: de acuerdo a alguna columna del dataset dividen el gráfico manteniendo las escalas. Esto es opcional y se hace con <strong>facet_grid()</strong>.</li>
<li><strong>Temas</strong> que permiten elegir la estética general del gráfico (color de fondo, tamaño de márgenes, etc). Algunos son <strong>theme_void()</strong>, <strong>theme_dark()</strong>, etc.</li>
</ul>
<p>A continuación seguiremos trabajando con los datos de Properati de Junio y Julio 2020 en AMBA y desarrollaremos diferentes visualizaciones que sinteticen y comuniquen la información que contiene.</p>
<p>En particular, veremos como representar gráficamente lo siguiente:</p>
<ul>
<li>Distribución de una variable continua</li>
<li>Distribución de valores continuos asociados a una variable categórica</li>
<li>Relación entre variables continuas</li>
<li>Relación entre variables categóricas</li>
<li>Relación entre una variable continua y una categórica</li>
</ul>
<p>Empecemos activando la librería <code>tidyverse</code>:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<p>Y volvamos a cargar nuestro dataset:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a>datos_amba &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/amba_properati.csv&quot;</span>)</span></code></pre></div>
<div id="histograma" class="section level2">
<h2><span class="header-section-number">3.1</span> Histograma</h2>
<p><strong>Distribución de una variable continua</strong></p>
<p>Los histogramas muestran gráficamente, a partir de barras, la distribución de una variable continua, es decir la frecuencia con la que aparece cada valor numérico en una determinada columna del dataset. En el eje X se representa la variable continua y en el eje Y la frecuencia de la misma.</p>
<p>Para generar este tipo de visualización utilizaremos <code>ggplot()</code> + <code>geom_histogram()</code>. Veamos por ejemplo como se distribuyen las superficies cubiertas (surface_covered) de las propiedades publicadas:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb109-2"><a href="#cb109-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>surface_covered))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-115-1.png" width="1050" /></p>
<p>El eje X muestra la cantidad de m2 cubiertos que tienen las propiedades publicadas y el eje Y la cantidad de veces que aparece cada superficie. Por lo tanto, podemos ver que hay muchas propiedades con “poca” superficie cubierta y pocas propiedades con “mucha” superficie cubierta.</p>
<p>Para facilitar la interpretación, podemos modificar el ancho de las barras (bins) que por defecto el valor es 30. Probemos con bins=75:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb110-2"><a href="#cb110-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>surface_covered), <span class="dt">bins=</span><span class="dv">75</span>)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-116-1.png" width="1050" /></p>
<p>¿Notan el cambio? El eje Y disminuyó porque los conteos se agruparon en intervalos más pequeños sobre el eje X.</p>
<p>Podemos observar que hay más propiedades por debajo de los 100m2 cubiertos que por encima, y que la mayor cantidad de observaciones se ubica alrededor de los 50m2. También podemos detectar algunos outliers que tienen alrededor de 800m2.</p>
<p>Pero desagreguemos aún más nuestros datos y sumemos una variable categórica (tipo de operación) que nos permita facetar/dividir el gráfico. Para esto utilizaremos <code>facet_grid()</code>:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb111-2"><a href="#cb111-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>surface_covered), <span class="dt">bins=</span><span class="dv">75</span>) <span class="op">+</span></span>
<span id="cb111-3"><a href="#cb111-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(operation_type<span class="op">~</span>.)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-117-1.png" width="1050" /></p>
<p>La tendencia se mantiene similar en ambos casos, con una mayoría de propiedades de aproximadamente 50m2 cubiertos. Sin embargo, se detecta una gran diferencia en la cantidad de propiedades publicadas para cada tipo de operación.</p>
<p>Incorporemos una variable más (provincia) que nos permita comprender si los comportamientos de la variable surface_covered cambian entre CABA y PBA. En este caso la agregaremos como un color de relleno (fill):</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb112-2"><a href="#cb112-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>surface_covered, <span class="dt">fill=</span>provincia), <span class="dt">bins=</span><span class="dv">75</span>)<span class="op">+</span></span>
<span id="cb112-3"><a href="#cb112-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(operation_type<span class="op">~</span>.)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-118-1.png" width="1050" /></p>
<p>Podemos ver que tanto en CABA como en AMBA, los comportamientos de la variable analizada son similares.</p>
<p>Por último probemos sumar una variable más dentro del facetado (fecha de publicación), agreguemos etiquetas (labs) y elijamos los colores del gráfico (scale_fill y theme).</p>
<p>Cabe destacar que hay 2 tipos de escalas de color:</p>
<ul>
<li><p>Las ya establecidas (listas para usar): Brewer, Viridis. Recomiendo utilizar estas que en <code>ggplot2</code> las van a encontrar como scale_fill_viridis_c(), scale_fill_brewer() y demás variantes.</p></li>
<li><p>Las personalizadas, donde nosotros elegimos todos los colores: Gradiente (scale_fill_gradient()), Manual (scale_fill_manual())
<em>Para obtener un listado de colores pueden ver este link: <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf" class="uri">http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf</a></em></p></li>
</ul>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb113-2"><a href="#cb113-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>surface_covered, <span class="dt">fill=</span>provincia), <span class="dt">bins=</span><span class="dv">75</span>)<span class="op">+</span></span>
<span id="cb113-3"><a href="#cb113-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(created_on<span class="op">~</span>operation_type)<span class="op">+</span></span>
<span id="cb113-4"><a href="#cb113-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;M2 cubiertos según Zona, Operación y Fecha de Publicación&quot;,</span></span>
<span id="cb113-5"><a href="#cb113-5"></a><span class="st">       fill=&quot;</span>Zona<span class="st">&quot;,</span></span>
<span id="cb113-6"><a href="#cb113-6"></a><span class="st">       x=&quot;</span>Superficie <span class="kw">cubierta</span> (M2)<span class="st">&quot;,</span></span>
<span id="cb113-7"><a href="#cb113-7"></a><span class="st">       y=&quot;</span>Cantidad<span class="st">&quot;,</span></span>
<span id="cb113-8"><a href="#cb113-8"></a><span class="st">       caption=&quot;</span>Fuente<span class="op">:</span><span class="st"> </span>Properati Junio y Julio <span class="dv">2020</span><span class="st">&quot;)+</span></span>
<span id="cb113-9"><a href="#cb113-9"></a><span class="st">  scale_fill_manual(values = c(&quot;</span>goldenrod2<span class="st">&quot;, &quot;</span>indianred2<span class="st">&quot;))+</span></span>
<span id="cb113-10"><a href="#cb113-10"></a><span class="st">  theme_light()</span></span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-119-1.png" width="1050" /></p>
<p>En el histograma anterior se puede ver que si bien en ambos meses las distribuciones se mantienen, en Junio hay mayor cantidad de publicaciones que en Julio.</p>
</div>
<div id="gráfico-de-densidad" class="section level2">
<h2><span class="header-section-number">3.2</span> Gráfico de Densidad</h2>
<p><strong>Distribución de una variable continua</strong></p>
<p>Este tipo de gráfico cumple la misma función que el Histograma, pero se caracteriza por generar una versión más “suavizada” en la que muestra la densidad de kernel a lo largo de toda la variable continua y no conteos por bins. Estos gráficos nos permiten ver cuales son los intervalos de la variable continua donde hay mayor probabilidad de encontrar registros.</p>
<p>Para generar esta visualización utilizaremos <code>ggplot()</code> + <code>geom_density()</code>. Veamos por ejemplo como se distribuyen los valores por m2 (price/surface_covered) de las propiedades publicadas:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb114-2"><a href="#cb114-2"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x=</span>price<span class="op">/</span>surface_covered))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-120-1.png" width="1050" /></p>
<p>En primer lugar, tenemos los valores del eje Y en notación científica. Si queremos evitar esto es necesario que escribamos la siguiente línea de código:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a><span class="kw">options</span>(<span class="dt">scipen=</span><span class="dv">999</span>)</span></code></pre></div>
<p>Y ahora si, ejecutar nuevamente el chunk anterior:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb116-2"><a href="#cb116-2"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x=</span>price<span class="op">/</span>surface_covered))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-122-1.png" width="1050" /></p>
<p>En el gráfico se ven 2 “picos” muy pronunciados que indican en que partes del intervalo se concentran los valores. Esto podría deberse a que estamos trabajando con ambos tipos de operación (Alquiler y Venta), y como todos sabemos, los valores del m2 de ambos son muy diferentes, tanto por la moneda (ARS vs USD) como por los montos.
Por lo tanto, es muy probable que cada uno de esos “picos” se corresponda al valor del m2 de cada una de las operaciones. Para poder desemascarar esto recurramos nuevamente al facetado:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb117-2"><a href="#cb117-2"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x=</span>price<span class="op">/</span>surface_covered), <span class="dt">fill=</span><span class="st">&quot;gray&quot;</span>) <span class="op">+</span></span>
<span id="cb117-3"><a href="#cb117-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(operation_type<span class="op">~</span>.)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-123-1.png" width="1050" /></p>
<p>Las operaciones tienen una distribución del valor del m2 muy diferentes entre sí. Se ve muy claro que los alquileres tienen un rango de precios que va desde 300 a 500$ARS aprox mientras que las ventas distribuyen sus publicaciones a lo largo de un rango bastante mayor entre 1.500USD y 3.500USD aproximadamente.</p>
<p>Pero como los precios también deberían variar bastante de acuerdo a la zona geográfica, probemos agregar una variable categórica más que nos ayude a diferenciar CABA de GBA:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb118-2"><a href="#cb118-2"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x=</span>price<span class="op">/</span>surface_covered, <span class="dt">fill=</span>provincia), <span class="dt">alpha=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb118-3"><a href="#cb118-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(operation_type<span class="op">~</span>.)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-124-1.png" width="1050" /></p>
<p>Obviamente para cada partido, localidad y calle específica los valores van a variar, pero a simple vista podríamos notar que en ambos casos el valor del m2 de la mayoría de propiedades es mayor en CABA.</p>
<p>Ahora analicemos como se comporta el valor del m2 de venta según el tipo de propiedad en CABA y GBA y aprovechemos para agregar etiquetas y colores a nuestro gráfico:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2"></a><span class="st">         </span><span class="kw">filter</span>(operation_type<span class="op">==</span><span class="st">&quot;Venta&quot;</span>))<span class="op">+</span></span>
<span id="cb119-3"><a href="#cb119-3"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x=</span>price<span class="op">/</span>surface_covered, <span class="dt">fill=</span>provincia), <span class="dt">alpha=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb119-4"><a href="#cb119-4"></a><span class="st">  </span><span class="kw">facet_grid</span>(property_type<span class="op">~</span>.)<span class="op">+</span></span>
<span id="cb119-5"><a href="#cb119-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Valor del m2 en Venta según Zona y Tipo de Propiedad&quot;</span>,</span>
<span id="cb119-6"><a href="#cb119-6"></a>       <span class="dt">fill=</span><span class="st">&quot;Zona&quot;</span>,</span>
<span id="cb119-7"><a href="#cb119-7"></a>       <span class="dt">x=</span><span class="st">&quot;Valor m2&quot;</span>,</span>
<span id="cb119-8"><a href="#cb119-8"></a>       <span class="dt">y=</span><span class="st">&quot;Densidad&quot;</span>,</span>
<span id="cb119-9"><a href="#cb119-9"></a>       <span class="dt">caption=</span><span class="st">&quot;Fuente: Properati Junio y Julio 2020&quot;</span>)<span class="op">+</span></span>
<span id="cb119-10"><a href="#cb119-10"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;goldenrod2&quot;</span>, <span class="st">&quot;indianred2&quot;</span>))<span class="op">+</span></span>
<span id="cb119-11"><a href="#cb119-11"></a><span class="st">  </span><span class="kw">theme_light</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-125-1.png" width="1050" /></p>
<p>En las 3 tipologías de vivienda los valores del m2 que predominan en CABA son mayores a los de GBA.</p>
<p>Y ahora elijamos 3 partidos para comparar:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb120-2"><a href="#cb120-2"></a><span class="st">         </span><span class="kw">filter</span>(operation_type<span class="op">==</span><span class="st">&quot;Venta&quot;</span> <span class="op">&amp;</span><span class="st"> </span>partido<span class="op">==</span><span class="kw">c</span>(<span class="st">&quot;Vicente López&quot;, &quot;</span>La Matanza<span class="st">&quot;, &quot;</span>La Plata<span class="st">&quot;)))+</span></span>
<span id="cb120-3"><a href="#cb120-3"></a><span class="st">  geom_density(aes(x=price/surface_covered, fill=partido), alpha=0.5) +</span></span>
<span id="cb120-4"><a href="#cb120-4"></a><span class="st">  facet_grid(property_type~.)+</span></span>
<span id="cb120-5"><a href="#cb120-5"></a><span class="st">  labs(title=&quot;</span>Valor del m2 en Venta por Partido y Tipo de Propiedad<span class="st">&quot;,</span></span>
<span id="cb120-6"><a href="#cb120-6"></a><span class="st">       fill=&quot;</span>Zona<span class="st">&quot;,</span></span>
<span id="cb120-7"><a href="#cb120-7"></a><span class="st">       x=&quot;</span>Valor m2<span class="st">&quot;,</span></span>
<span id="cb120-8"><a href="#cb120-8"></a><span class="st">       y=&quot;</span>Densidad<span class="st">&quot;,</span></span>
<span id="cb120-9"><a href="#cb120-9"></a><span class="st">       caption=&quot;</span>Fuente<span class="op">:</span><span class="st"> </span>Properati Junio y Julio <span class="dv">2020</span><span class="st">&quot;)+</span></span>
<span id="cb120-10"><a href="#cb120-10"></a><span class="st">  theme_light()</span></span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-126-1.png" width="1050" /></p>
<p>En las 3 tipologías se ve que Vicente López tiene los precios más elevados por m2, y a su vez que los departamentos de La Matanza superan en precio a los de La Plata. Sin embargo, para casas y PHs, La Matanza y La Plata tienen precios muy similares.</p>
</div>
<div id="gráfico-de-cajas" class="section level2">
<h2><span class="header-section-number">3.3</span> Gráfico de Cajas</h2>
<p><strong>Distribución de valores continuos asociados a una variable categórica</strong></p>
<p>Un Gráfico de Cajas sirve para comparar la distribución y tendencia central de varias categorías de una variable.</p>
<p>Veamos como luce un gráfico de este tipo:</p>
<p><img src="images/geom_boxplot.jpg" /></p>
<p>Para cumplir con el objetivo de analizar la distribución de una determinada muestra de datos, <strong>la visualización distribuye los datos en cuartiles: Q1, Q2 y Q3</strong>. Cabe destacar que, los cuartiles son los valores que dividen a la muestra (cantidad de registros) en 4 partes iguales.</p>
<p><strong>Q1</strong>: El primer cuartil está representado por el mayor valor incluido en el 1/4 más bajo. Es decir que, el 25% de la muestra de datos es menor que este valor.</p>
<p><strong>Q2</strong>: El segundo cuartil está representado por el mayor valor incluido en el 2/4. Es decir que, el 50% de la muestra de datos es menor que este valor. Este valor indica la <strong>mediana de la serie</strong>.</p>
<p><strong>Q3</strong>: El tercer cuartil está representado por el mayor valor incluido en el 3/4. Es decir que, el 75% de la muestra de datos es menor que este valor.</p>
<p>En este gráfico también pueden aparecer <strong>outliers</strong>, es decir valores extremos que haya dentro de los conjuntos de datos.</p>
<p>Para generar esta visualización utilizaremos <code>ggplot()</code> + <code>geom_boxplot()</code>. Veamos por ejemplo como se distribuyen los valores por m2 (price/surface_covered) por zona:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a><span class="kw">ggplot</span>(datos_amba) <span class="op">+</span></span>
<span id="cb121-2"><a href="#cb121-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> provincia, <span class="dt">y =</span> price<span class="op">/</span>surface_covered))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-127-1.png" width="1050" /></p>
<p>En el gráfico anterior podemos observar que la mediana del valor del m2 en CABA es superior al de GBA, pero estamos mezclando datos de ambos tipos de operaciones (alquileres y ventas), lo cual no es correcto. Para mejorar este aspecto facetemos el gráfico según tipo de operación:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a><span class="kw">ggplot</span>(datos_amba) <span class="op">+</span></span>
<span id="cb122-2"><a href="#cb122-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> provincia, <span class="dt">y =</span> price<span class="op">/</span>surface_covered)) <span class="op">+</span></span>
<span id="cb122-3"><a href="#cb122-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>operation_type)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-128-1.png" width="1050" /></p>
<p>Si bien los valores que se manejan en cada operación son muy diferentes entre sí, en ambos casos se mantiene que la <strong>mediana del valor del m2 en CABA es superior que en GBA</strong>. Sin embargo, como las 2 escalas son muy diferentes, casi no se ven las cajas correspondientes a los alquileres.</p>
<p>Hagamos un filtro por Alquileres para ver mejor que ocurre ahí:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb123-2"><a href="#cb123-2"></a><span class="st">         </span><span class="kw">filter</span>(operation_type<span class="op">==</span><span class="st">&quot;Alquiler&quot;</span>)) <span class="op">+</span></span>
<span id="cb123-3"><a href="#cb123-3"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> provincia, <span class="dt">y =</span> price<span class="op">/</span>surface_covered, <span class="dt">fill=</span>provincia), <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb123-4"><a href="#cb123-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Distribución del valor del m2 de Alquileres en CABA y GBA&quot;</span>,</span>
<span id="cb123-5"><a href="#cb123-5"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Publicaciones de Junio y Julio 2020&quot;</span>,</span>
<span id="cb123-6"><a href="#cb123-6"></a>       <span class="dt">y =</span> <span class="st">&quot;Valor del m2&quot;</span>,</span>
<span id="cb123-7"><a href="#cb123-7"></a>       <span class="dt">x =</span> <span class="st">&quot;Zona&quot;</span>,</span>
<span id="cb123-8"><a href="#cb123-8"></a>       <span class="dt">caption =</span> <span class="st">&quot;Fuente: Properati&quot;</span>)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-129-1.png" width="1050" /></p>
<p>La mediana de CABA está por encima pero claramente dentro de CABA hay muchas diferencias entre Comunas. Grafiquemos esto con datos de CABA desagregados por Comuna:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb124-2"><a href="#cb124-2"></a><span class="st">         </span><span class="kw">filter</span>(operation_type<span class="op">==</span><span class="st">&quot;Alquiler&quot;</span> <span class="op">&amp;</span><span class="st"> </span>provincia<span class="op">==</span><span class="st">&quot;CABA&quot;</span>)) <span class="op">+</span></span>
<span id="cb124-3"><a href="#cb124-3"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> partido, <span class="dt">y =</span> price<span class="op">/</span>surface_covered, <span class="dt">fill=</span>partido), <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb124-4"><a href="#cb124-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Distribución del valor del m2 de Alquileres en CABA y GBA&quot;</span>,</span>
<span id="cb124-5"><a href="#cb124-5"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Publicaciones de Junio y Julio 2020&quot;</span>,</span>
<span id="cb124-6"><a href="#cb124-6"></a>       <span class="dt">y =</span> <span class="st">&quot;Valor del m2&quot;</span>,</span>
<span id="cb124-7"><a href="#cb124-7"></a>       <span class="dt">x =</span> <span class="st">&quot;Comuna&quot;</span>,</span>
<span id="cb124-8"><a href="#cb124-8"></a>       <span class="dt">caption =</span> <span class="st">&quot;Fuente: Properati&quot;</span>)<span class="op">+</span></span>
<span id="cb124-9"><a href="#cb124-9"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-130-1.png" width="1050" /></p>
<p>Se ve que:</p>
<ul>
<li>La Comuna 14 y la Comuna 1 tienen una mediana muy similar en el valor del m2 (el más alto de CABA).</li>
<li>La Comuna 14 presenta la mayor cantidad de outliers, motivo por el cual al calcular promedios siempre está por encima de la Comuna 1.</li>
<li>La Comuna 1 presenta la mayor variación en el valor del m2: va desde 200ARS hasta 1500ARS aprox. Esto se puede deber a la heterogeneidad de barrios que contiene.</li>
<li>La Comuna 8 tiene muy pocas observaciones.</li>
<li>La Comuna 10 presenta el menor valor del m2.</li>
</ul>
<p>Veamos que pasa si filtramos solo PBA y lo desagregamos por Partido:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb125-2"><a href="#cb125-2"></a><span class="st">         </span><span class="kw">filter</span>(operation_type<span class="op">==</span><span class="st">&quot;Alquiler&quot;</span> <span class="op">&amp;</span><span class="st"> </span>provincia<span class="op">==</span><span class="st">&quot;GBA&quot;</span>)) <span class="op">+</span></span>
<span id="cb125-3"><a href="#cb125-3"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> partido, <span class="dt">y =</span> price<span class="op">/</span>surface_covered, <span class="dt">fill=</span>partido), <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb125-4"><a href="#cb125-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Distribución del valor del m2 de Alquileres en CABA y GBA&quot;</span>,</span>
<span id="cb125-5"><a href="#cb125-5"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Publicaciones de Junio y Julio 2020&quot;</span>,</span>
<span id="cb125-6"><a href="#cb125-6"></a>       <span class="dt">y =</span> <span class="st">&quot;Valor del m2&quot;</span>,</span>
<span id="cb125-7"><a href="#cb125-7"></a>       <span class="dt">x =</span> <span class="st">&quot;Partido&quot;</span>,</span>
<span id="cb125-8"><a href="#cb125-8"></a>       <span class="dt">caption =</span> <span class="st">&quot;Fuente: Properati&quot;</span>)<span class="op">+</span></span>
<span id="cb125-9"><a href="#cb125-9"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-131-1.png" width="1050" /></p>
<p>Acá vemos que:</p>
<ul>
<li>Vicente López presenta la mayor variación en el valor del m2 y la mediana más alta de los partidos incluidos en la base.</li>
<li>Presidente Perón es el partido de la base con menor valor del m2.</li>
</ul>
<p>Este análisis también podríamos hacerlo comparando entre partidos específicos y diferenciando por mes de publicación, por ejemplo:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb126-2"><a href="#cb126-2"></a><span class="st">         </span><span class="kw">filter</span>(operation_type<span class="op">==</span><span class="st">&quot;Alquiler&quot;</span> <span class="op">&amp;</span><span class="st"> </span>partido<span class="op">==</span><span class="kw">c</span>(<span class="st">&quot;Vicente López&quot;, &quot;</span>La Matanza<span class="st">&quot;, &quot;</span>La Plata<span class="st">&quot;))) +</span></span>
<span id="cb126-3"><a href="#cb126-3"></a><span class="st">  geom_boxplot(aes(x = partido, y = price/surface_covered, fill=partido), show.legend = FALSE) +</span></span>
<span id="cb126-4"><a href="#cb126-4"></a><span class="st">  labs(title = &quot;</span>Distribución del valor del m2 de CABA y GBA<span class="st">&quot;,</span></span>
<span id="cb126-5"><a href="#cb126-5"></a><span class="st">       subtitle = &quot;</span>Junio y Julio <span class="dv">2020</span><span class="st">&quot;,</span></span>
<span id="cb126-6"><a href="#cb126-6"></a><span class="st">       y = &quot;</span>Valor del m2<span class="st">&quot;,</span></span>
<span id="cb126-7"><a href="#cb126-7"></a><span class="st">       x = &quot;</span>Partido<span class="st">&quot;,</span></span>
<span id="cb126-8"><a href="#cb126-8"></a><span class="st">       color = &quot;</span>Partido<span class="st">&quot;,</span></span>
<span id="cb126-9"><a href="#cb126-9"></a><span class="st">       caption = &quot;</span>Fuente<span class="op">:</span><span class="st"> </span>Properati<span class="st">&quot;)+</span></span>
<span id="cb126-10"><a href="#cb126-10"></a><span class="st">  facet_grid(created_on~.)+</span></span>
<span id="cb126-11"><a href="#cb126-11"></a><span class="st">  scale_fill_brewer(palette = &quot;</span>Set3<span class="st">&quot;)+</span></span>
<span id="cb126-12"><a href="#cb126-12"></a><span class="st">  coord_flip()</span></span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-132-1.png" width="1050" /></p>
</div>
<div id="gráfico-de-dispersión" class="section level2">
<h2><span class="header-section-number">3.4</span> Gráfico de Dispersión</h2>
<p><strong>Relación entre variables numéricas</strong></p>
<p>Ahora veamos el clásico gráfico de puntos o scatter plot que muestra la dispersión que existe entre 2 variables numéricas representadas en los 2 ejes X e Y, y que permite identificar si existe o no una relación entre ambas.</p>
<p>Veamos por ejemplo, si existe relación entre la superficie cubierta (surface_covered) y el precio total (price) de las propiedades:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb127-2"><a href="#cb127-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>surface_covered, <span class="dt">y=</span>price))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-133-1.png" width="1050" /></p>
<p>Tiene sentido, a mayor superficie cubierta, mayor valor. Pero veamos esto desagregado entre tipos de operaciones a ver que pasa:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb128-2"><a href="#cb128-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>surface_covered, <span class="dt">y=</span>price, <span class="dt">color=</span>operation_type), <span class="dt">alpha=</span><span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-134-1.png" width="1050" /></p>
<p>A los gráficos de dispersión también se les puede agregar una tercer variable categórica o numérica que puede verse reflejada en la estética de los puntos (color, forma o tamaño).</p>
<p>Agreguemos una tercer variable (categórica) a nuestro gráfico: la provincia</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb129-2"><a href="#cb129-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>surface_covered, <span class="dt">y=</span>price, <span class="dt">color=</span>operation_type), <span class="dt">alpha=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb129-3"><a href="#cb129-3"></a><span class="st">  </span><span class="kw">facet_grid</span>(provincia<span class="op">~</span>.)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-135-1.png" width="1050" /></p>
<p>Podemos ver que en GBA no crece tan rápido la relación como en CABA.</p>
<p>Quedemonos solo con las ventas y agreguemos una tercer variable numérica: el valor del m2</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb130-2"><a href="#cb130-2"></a><span class="st">         </span><span class="kw">filter</span>(operation_type<span class="op">==</span><span class="st">&quot;Venta&quot;</span>))<span class="op">+</span></span>
<span id="cb130-3"><a href="#cb130-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>surface_covered, <span class="dt">y=</span>price, <span class="dt">color=</span>price<span class="op">/</span>surface_covered), <span class="dt">alpha=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb130-4"><a href="#cb130-4"></a><span class="st">  </span><span class="kw">facet_grid</span>(provincia<span class="op">~</span>.) <span class="op">+</span></span>
<span id="cb130-5"><a href="#cb130-5"></a><span class="st">  </span><span class="kw">scale_color_viridis_c</span>(<span class="dt">option=</span><span class="st">&quot;magma&quot;</span>)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-136-1.png" width="1050" /></p>
<p>Ahora aprovechemos que tenemos longitud y latitud de cada registro y hagamos un gráfico de puntos que nos permita ver la relación entre ambas variables:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb131-2"><a href="#cb131-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>datos_amba, <span class="kw">aes</span>(<span class="dt">x=</span>lon, <span class="dt">y=</span>lat))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-137-1.png" width="1050" /></p>
<p>¿A qué se parece? ¿Tiene forma de AMBA? Probemos coloreando según la variable provincia.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb132-2"><a href="#cb132-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>datos_amba, <span class="kw">aes</span>(<span class="dt">x=</span>lon, <span class="dt">y=</span>lat, <span class="dt">color=</span>provincia))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-138-1.png" width="1050" /></p>
</div>
<div id="gráfico-de-matriz" class="section level2">
<h2><span class="header-section-number">3.5</span> Gráfico de Matriz</h2>
<p><strong>Relación entre variables categóricas</strong></p>
<p>Este tipo de gráfico representa un mapa de calor bidimensional que muestra la frecuencia que existe entre 2 variables dentro de la base de datos.</p>
<p>Para poder desarrollar la visualización es necesario elegir 3 variables:</p>
<p><strong>x</strong>: variable a ubicar en el eje X</p>
<p><strong>y</strong>: variable a ubicar en el eje Y</p>
<p><strong>fill</strong>: valor numérico que será representado a partir de los colores</p>
<p>Veamos un ejemplo relacionando el partido y la cantidad de ambientes:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb133-2"><a href="#cb133-2"></a><span class="st">              </span><span class="kw">group_by</span>(partido, rooms) <span class="op">%&gt;%</span></span>
<span id="cb133-3"><a href="#cb133-3"></a><span class="st">              </span><span class="kw">summarise</span>(<span class="dt">cantidad=</span><span class="kw">n</span>())) <span class="op">+</span><span class="st"> </span></span>
<span id="cb133-4"><a href="#cb133-4"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x =</span> partido,</span>
<span id="cb133-5"><a href="#cb133-5"></a>                <span class="dt">y =</span> <span class="kw">as.factor</span>(rooms),</span>
<span id="cb133-6"><a href="#cb133-6"></a>                <span class="dt">fill =</span> cantidad))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-139-1.png" width="1050" /></p>
<p>Mejoremos con <code>coord_flip()</code> el aspecto de la visualización:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb134-2"><a href="#cb134-2"></a><span class="st">              </span><span class="kw">group_by</span>(partido, rooms) <span class="op">%&gt;%</span></span>
<span id="cb134-3"><a href="#cb134-3"></a><span class="st">              </span><span class="kw">summarise</span>(<span class="dt">cantidad=</span><span class="kw">n</span>())) <span class="op">+</span><span class="st"> </span></span>
<span id="cb134-4"><a href="#cb134-4"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x =</span> partido,</span>
<span id="cb134-5"><a href="#cb134-5"></a>                <span class="dt">y =</span> <span class="kw">as.factor</span>(rooms),</span>
<span id="cb134-6"><a href="#cb134-6"></a>                <span class="dt">fill =</span> cantidad)) <span class="op">+</span></span>
<span id="cb134-7"><a href="#cb134-7"></a><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>() <span class="op">+</span></span>
<span id="cb134-8"><a href="#cb134-8"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-140-1.png" width="1050" /></p>
<p>Se puede ver por ejemplo que la relación Comuna 14 + 2 ambientes, y Comuna 14 + 3 ambientes es la que más se repite (más de 600 veces cada una). Filtremos solo CABA:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb135-2"><a href="#cb135-2"></a><span class="st">              </span><span class="kw">filter</span>(provincia<span class="op">==</span><span class="st">&quot;CABA&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb135-3"><a href="#cb135-3"></a><span class="st">              </span><span class="kw">group_by</span>(partido, rooms) <span class="op">%&gt;%</span></span>
<span id="cb135-4"><a href="#cb135-4"></a><span class="st">              </span><span class="kw">summarise</span>(<span class="dt">cantidad=</span><span class="kw">n</span>())) <span class="op">+</span><span class="st"> </span></span>
<span id="cb135-5"><a href="#cb135-5"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(partido),</span>
<span id="cb135-6"><a href="#cb135-6"></a>                <span class="dt">y =</span> <span class="kw">as.factor</span>(rooms),</span>
<span id="cb135-7"><a href="#cb135-7"></a>                <span class="dt">fill =</span> cantidad)) <span class="op">+</span></span>
<span id="cb135-8"><a href="#cb135-8"></a><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>() <span class="op">+</span></span>
<span id="cb135-9"><a href="#cb135-9"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-141-1.png" width="1050" /></p>
<p>Obviamente se sigue viendo lo mismo de la Comuna 14 pero también se empieza a ver como la Comuna 13 y 15 también aparecen mucho con propiedades de 2 y 3 ambientes. Veamos el caso de GBA:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb136-2"><a href="#cb136-2"></a><span class="st">              </span><span class="kw">filter</span>(provincia<span class="op">==</span><span class="st">&quot;GBA&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb136-3"><a href="#cb136-3"></a><span class="st">              </span><span class="kw">group_by</span>(partido, rooms) <span class="op">%&gt;%</span></span>
<span id="cb136-4"><a href="#cb136-4"></a><span class="st">              </span><span class="kw">summarise</span>(<span class="dt">cantidad=</span><span class="kw">n</span>())) <span class="op">+</span><span class="st"> </span></span>
<span id="cb136-5"><a href="#cb136-5"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(partido),</span>
<span id="cb136-6"><a href="#cb136-6"></a>                <span class="dt">y =</span> <span class="kw">as.factor</span>(rooms),</span>
<span id="cb136-7"><a href="#cb136-7"></a>                <span class="dt">fill =</span> cantidad)) <span class="op">+</span></span>
<span id="cb136-8"><a href="#cb136-8"></a><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>() <span class="op">+</span></span>
<span id="cb136-9"><a href="#cb136-9"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-142-1.png" width="1050" /></p>
<p>En GBA la mayor cantidad se ve en Tigre con 3 ambientes, seguida por 2 y 4. También hay varias propiedades de 2 y 3 ambientes en La Plata.</p>
</div>
<div id="gráfico-de-barras" class="section level2">
<h2><span class="header-section-number">3.6</span> Gráfico de Barras</h2>
<p><strong>Relación entre variable numérica y categórica</strong></p>
<p>El gráfico de barras representa, a partir de la longitud de las barras, el valor numérico (eje Y) asociado a cada entidad de la variable categórica (eje X).</p>
<p>Al igual que en el resto de visualizaciones, es necesario elegir una variable para el eje X y otra para el eje Y (acá se llama weight). Sin embargo, si no asignamos ninguna variable numérica a weight, el gráfico automáticamente va a calcular cuantas veces aparece cada categoría en la base de datos.</p>
<p>Por ejemplo, veamos cuantas observaciones hay por tipo de operación:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb137-2"><a href="#cb137-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>operation_type))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-143-1.png" width="1050" /></p>
<p>En el gráfico anterior podemos ver que hay alrededor de 12.000 propiedades en venta y 3.000 en alquiler.</p>
<p>Veamos esto desagregado por tipo de propiedad:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb138-2"><a href="#cb138-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>operation_type, <span class="dt">fill=</span>property_type))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-144-1.png" width="1050" /></p>
<p>Como ya venimos viendo a lo largo de todo el capítulo, predominan los departamentos en ambos casos. Veamos esto también por zona y ajustemos cuestiones estéticas del gráfico:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb139-2"><a href="#cb139-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>operation_type, <span class="dt">fill=</span>property_type)) <span class="op">+</span></span>
<span id="cb139-3"><a href="#cb139-3"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;goldenrod2&quot;</span>, <span class="st">&quot;turquoise4&quot;</span>, <span class="st">&quot;deeppink3&quot;</span>)) <span class="op">+</span></span>
<span id="cb139-4"><a href="#cb139-4"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>provincia)<span class="op">+</span></span>
<span id="cb139-5"><a href="#cb139-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Oferta publicada según Zona por Operación y Tipo de Propiedad&quot;</span>,</span>
<span id="cb139-6"><a href="#cb139-6"></a>       <span class="dt">fill=</span><span class="st">&quot;Tipo&quot;</span>,</span>
<span id="cb139-7"><a href="#cb139-7"></a>       <span class="dt">x=</span><span class="st">&quot;Operación&quot;,</span></span>
<span id="cb139-8"><a href="#cb139-8"></a><span class="st">       y=&quot;</span>Cantidad<span class="st">&quot;,</span></span>
<span id="cb139-9"><a href="#cb139-9"></a><span class="st">       caption=&quot;</span>Fuente<span class="op">:</span><span class="st"> </span>Properati Junio y Julio <span class="dv">2020</span><span class="st">&quot;)</span></span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-145-1.png" width="1050" /></p>
<p>Siguen predominando los departamentos pero también se puede ver como la cantidad de casas en venta en GBA es muy similar a la de departamentos.</p>
<p>Las <strong>barras apiladas con valores absolutos</strong> es una de las opciones a la hora de graficar y la que nos hace por defecto <code>ggplot2</code>, pero existen 2 más: las barras apiladas con valores relativos (%) y las barras agrupadas con valores absolutos.</p>
<p>Veamos de que se trata cada una!</p>
<p><strong>Barras apiladas con valores relativos (%)</strong></p>
<p>Este tipo de gráfico ayuda a detectar las diferencias relativas que existen entre los valores continuos de cada grupo/categoría. Cada barra del gráfico muestra el total de cada categoría y se representa por el apilado de los porcentajes de cada valor. Con <code>ggplot()</code> usaremos <code>position=position_fill()</code>:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb140-2"><a href="#cb140-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>operation_type, <span class="dt">fill=</span>property_type), <span class="dt">position=</span><span class="kw">position_fill</span>()) <span class="op">+</span></span>
<span id="cb140-3"><a href="#cb140-3"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;goldenrod2&quot;</span>, <span class="st">&quot;turquoise4&quot;</span>, <span class="st">&quot;deeppink3&quot;</span>)) <span class="op">+</span></span>
<span id="cb140-4"><a href="#cb140-4"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>provincia)<span class="op">+</span></span>
<span id="cb140-5"><a href="#cb140-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Oferta publicada según Zona por Operación y Tipo de Propiedad&quot;</span>,</span>
<span id="cb140-6"><a href="#cb140-6"></a>       <span class="dt">fill=</span><span class="st">&quot;Tipo&quot;</span>,</span>
<span id="cb140-7"><a href="#cb140-7"></a>       <span class="dt">x=</span><span class="st">&quot;Operación&quot;,</span></span>
<span id="cb140-8"><a href="#cb140-8"></a><span class="st">       y=&quot;</span>Porcentaje<span class="st">&quot;,</span></span>
<span id="cb140-9"><a href="#cb140-9"></a><span class="st">       caption=&quot;</span>Fuente<span class="op">:</span><span class="st"> </span>Properati Junio y Julio <span class="dv">2020</span><span class="st">&quot;)</span></span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-146-1.png" width="1050" /></p>
<p><strong>Barras agrupadas con valores absolutos</strong></p>
<p>Este tipo de gráfico se utiliza cuando los datos absolutos se agrupan en 2 o más categorías dentro del mismo eje. Con <code>ggplot()</code> usaremos <code>position=position_dodge()</code>:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb141-2"><a href="#cb141-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>operation_type, <span class="dt">fill=</span>property_type), <span class="dt">position=</span><span class="kw">position_dodge</span>()) <span class="op">+</span></span>
<span id="cb141-3"><a href="#cb141-3"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;goldenrod2&quot;</span>, <span class="st">&quot;turquoise4&quot;</span>, <span class="st">&quot;deeppink3&quot;</span>)) <span class="op">+</span></span>
<span id="cb141-4"><a href="#cb141-4"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>provincia)<span class="op">+</span></span>
<span id="cb141-5"><a href="#cb141-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Oferta publicada según Zona por Operación y Tipo de Propiedad&quot;</span>,</span>
<span id="cb141-6"><a href="#cb141-6"></a>       <span class="dt">fill=</span><span class="st">&quot;Tipo&quot;</span>,</span>
<span id="cb141-7"><a href="#cb141-7"></a>       <span class="dt">x=</span><span class="st">&quot;Operación&quot;,</span></span>
<span id="cb141-8"><a href="#cb141-8"></a><span class="st">       y=&quot;</span>Cantidad<span class="st">&quot;,</span></span>
<span id="cb141-9"><a href="#cb141-9"></a><span class="st">       caption=&quot;</span>Fuente<span class="op">:</span><span class="st"> </span>Properati Junio y Julio <span class="dv">2020</span><span class="st">&quot;)</span></span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-147-1.png" width="1050" /></p>
<p>Ahora investiguemos otra variable de nuestro dataset, veamos <strong>de cuántos ambientes son las propiedades que predominan en cada zona para cada operación inmobiliaria</strong>:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a><span class="kw">ggplot</span>(datos_amba)<span class="op">+</span></span>
<span id="cb142-2"><a href="#cb142-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">as.factor</span>(rooms), <span class="dt">fill=</span>provincia), <span class="dt">position=</span><span class="kw">position_dodge</span>()) <span class="op">+</span></span>
<span id="cb142-3"><a href="#cb142-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Oferta de Propiedades en Alquiler&quot;</span>,</span>
<span id="cb142-4"><a href="#cb142-4"></a>       <span class="dt">subtitle=</span><span class="st">&quot;Según cantidad de ambientes&quot;</span>,</span>
<span id="cb142-5"><a href="#cb142-5"></a>       <span class="dt">fill=</span><span class="st">&quot;Zona&quot;</span>,</span>
<span id="cb142-6"><a href="#cb142-6"></a>       <span class="dt">x=</span><span class="st">&quot;Cantidad de Ambientes&quot;</span>,</span>
<span id="cb142-7"><a href="#cb142-7"></a>       <span class="dt">y=</span><span class="st">&quot;Cantidad&quot;</span>,</span>
<span id="cb142-8"><a href="#cb142-8"></a>       <span class="dt">caption=</span><span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb142-9"><a href="#cb142-9"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;goldenrod2&quot;</span>, <span class="st">&quot;indianred2&quot;</span>)) <span class="op">+</span></span>
<span id="cb142-10"><a href="#cb142-10"></a><span class="st">  </span><span class="kw">facet_grid</span>(operation_type<span class="op">~</span>.)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-148-1.png" width="1050" /></p>
<p>Vemos que:</p>
<ul>
<li>Los monoambientes publicados en CABA triplican los publicados en GBA.</li>
<li>Para ambas operaciones, en CABA predominan los 2 y 3 ambientes.</li>
<li>En las ventas de GBA predominan los 2, 3 y 4 ambientes.</li>
<li>Para ambas zonas, las propiedades con más de 5 ambientes solo se encuentran en venta (no en alquiler).</li>
</ul>
<p>Ahora entremos más en detalle y analicemos los datos por partido. Para eso filtremos por <strong>Ventas</strong> e incorporemos un valor weight: <strong>precio del m2</strong>. Como vimos que hay varios ouliers en los datos del valor del m2 que pueden afectar el promedio, utilizaremos la mediana:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb143-2"><a href="#cb143-2"></a><span class="st">        </span><span class="kw">group_by</span>(provincia, partido, operation_type) <span class="op">%&gt;%</span></span>
<span id="cb143-3"><a href="#cb143-3"></a><span class="st">        </span><span class="kw">summarise</span>(<span class="dt">cantidad=</span><span class="kw">n</span>(),</span>
<span id="cb143-4"><a href="#cb143-4"></a>                  <span class="dt">price_m2=</span><span class="kw">median</span>(price<span class="op">/</span>surface_covered)) <span class="op">%&gt;%</span></span>
<span id="cb143-5"><a href="#cb143-5"></a><span class="st">        </span><span class="kw">filter</span>(operation_type<span class="op">==</span><span class="st">&quot;Venta&quot;</span>))<span class="op">+</span></span>
<span id="cb143-6"><a href="#cb143-6"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(partido, price_m2), <span class="dt">weight=</span>price_m2, <span class="dt">fill=</span>provincia)) <span class="op">+</span></span>
<span id="cb143-7"><a href="#cb143-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Valor del m2 de Propiedades en Venta&quot;</span>,</span>
<span id="cb143-8"><a href="#cb143-8"></a>       <span class="dt">subtitle=</span><span class="st">&quot;CABA + GBA&quot;</span>,</span>
<span id="cb143-9"><a href="#cb143-9"></a>       <span class="dt">fill=</span><span class="st">&quot;Zona&quot;</span>,</span>
<span id="cb143-10"><a href="#cb143-10"></a>       <span class="dt">x=</span><span class="st">&quot;Partido&quot;</span>,</span>
<span id="cb143-11"><a href="#cb143-11"></a>       <span class="dt">y=</span><span class="st">&quot;Valor del m2 (USD)&quot;</span>,</span>
<span id="cb143-12"><a href="#cb143-12"></a>       <span class="dt">caption=</span><span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb143-13"><a href="#cb143-13"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;goldenrod2&quot;</span>, <span class="st">&quot;indianred2&quot;</span>)) <span class="op">+</span></span>
<span id="cb143-14"><a href="#cb143-14"></a><span class="st">  </span><span class="kw">theme_light</span>()<span class="op">+</span></span>
<span id="cb143-15"><a href="#cb143-15"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-149-1.png" width="1050" /></p>
<p>Se ve un poco empastado y es difícil de leer. Probemos filtrando solo aquellos donde el valor del m2 es mayor a 2.000 USD:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb144-2"><a href="#cb144-2"></a><span class="st">        </span><span class="kw">group_by</span>(provincia, partido, operation_type) <span class="op">%&gt;%</span></span>
<span id="cb144-3"><a href="#cb144-3"></a><span class="st">        </span><span class="kw">summarise</span>(<span class="dt">cantidad=</span><span class="kw">n</span>(),</span>
<span id="cb144-4"><a href="#cb144-4"></a>                  <span class="dt">price_m2=</span><span class="kw">median</span>(price<span class="op">/</span>surface_covered)) <span class="op">%&gt;%</span></span>
<span id="cb144-5"><a href="#cb144-5"></a><span class="st">        </span><span class="kw">filter</span>(operation_type<span class="op">==</span><span class="st">&quot;Venta&quot;</span> <span class="op">&amp;</span><span class="st"> </span>price_m2<span class="op">&gt;=</span><span class="dv">2000</span>))<span class="op">+</span></span>
<span id="cb144-6"><a href="#cb144-6"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(partido, price_m2), <span class="dt">weight=</span>price_m2, <span class="dt">fill=</span>provincia)) <span class="op">+</span></span>
<span id="cb144-7"><a href="#cb144-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Valor del m2 de Propiedades en Venta&quot;</span>,</span>
<span id="cb144-8"><a href="#cb144-8"></a>       <span class="dt">subtitle=</span><span class="st">&quot;CABA + GBA&quot;</span>,</span>
<span id="cb144-9"><a href="#cb144-9"></a>       <span class="dt">fill=</span><span class="st">&quot;Zona&quot;</span>,</span>
<span id="cb144-10"><a href="#cb144-10"></a>       <span class="dt">x=</span><span class="st">&quot;Partido&quot;</span>,</span>
<span id="cb144-11"><a href="#cb144-11"></a>       <span class="dt">y=</span><span class="st">&quot;Valor del m2 (USD)&quot;</span>,</span>
<span id="cb144-12"><a href="#cb144-12"></a>       <span class="dt">caption=</span><span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb144-13"><a href="#cb144-13"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;goldenrod2&quot;</span>, <span class="st">&quot;indianred2&quot;</span>)) <span class="op">+</span></span>
<span id="cb144-14"><a href="#cb144-14"></a><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></span>
<span id="cb144-15"><a href="#cb144-15"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-150-1.png" width="1050" /></p>
<p>Agreguemos etiquetas con <code>geom_text()</code> que nos faciliten la lectura:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1"></a><span class="kw">ggplot</span>(datos_amba <span class="op">%&gt;%</span></span>
<span id="cb145-2"><a href="#cb145-2"></a><span class="st">        </span><span class="kw">group_by</span>(provincia, partido, operation_type) <span class="op">%&gt;%</span></span>
<span id="cb145-3"><a href="#cb145-3"></a><span class="st">        </span><span class="kw">summarise</span>(<span class="dt">cantidad=</span><span class="kw">n</span>(),</span>
<span id="cb145-4"><a href="#cb145-4"></a>                  <span class="dt">price_m2=</span><span class="kw">median</span>(price<span class="op">/</span>surface_covered)) <span class="op">%&gt;%</span></span>
<span id="cb145-5"><a href="#cb145-5"></a><span class="st">        </span><span class="kw">filter</span>(operation_type<span class="op">==</span><span class="st">&quot;Venta&quot;</span> <span class="op">&amp;</span><span class="st"> </span>price_m2<span class="op">&gt;=</span><span class="dv">2000</span>))<span class="op">+</span></span>
<span id="cb145-6"><a href="#cb145-6"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(partido, price_m2), <span class="dt">weight=</span>price_m2, <span class="dt">fill=</span>provincia)) <span class="op">+</span></span>
<span id="cb145-7"><a href="#cb145-7"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x=</span>partido, <span class="dt">y=</span>price_m2<span class="op">+</span><span class="dv">100</span>, <span class="dt">label=</span><span class="kw">as.integer</span>(price_m2)), <span class="dt">size=</span><span class="fl">2.5</span>, <span class="dt">color=</span><span class="st">&quot;gray14&quot;</span>)<span class="op">+</span></span>
<span id="cb145-8"><a href="#cb145-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Valor del m2 de Propiedades en Venta&quot;</span>,</span>
<span id="cb145-9"><a href="#cb145-9"></a>       <span class="dt">subtitle=</span><span class="st">&quot;CABA + GBA&quot;</span>,</span>
<span id="cb145-10"><a href="#cb145-10"></a>       <span class="dt">fill=</span><span class="st">&quot;Zona&quot;</span>,</span>
<span id="cb145-11"><a href="#cb145-11"></a>       <span class="dt">x=</span><span class="st">&quot;Partido&quot;</span>,</span>
<span id="cb145-12"><a href="#cb145-12"></a>       <span class="dt">y=</span><span class="st">&quot;Valor del m2 (USD)&quot;</span>,</span>
<span id="cb145-13"><a href="#cb145-13"></a>       <span class="dt">caption=</span><span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb145-14"><a href="#cb145-14"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;goldenrod2&quot;</span>, <span class="st">&quot;indianred2&quot;</span>)) <span class="op">+</span></span>
<span id="cb145-15"><a href="#cb145-15"></a><span class="st">  </span><span class="kw">theme_light</span>() <span class="op">+</span></span>
<span id="cb145-16"><a href="#cb145-16"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-151-1.png" width="1050" /></p>
<!--chapter:end:03-graficar.Rmd-->
</div>
</div>
<div id="mapear" class="section level1">
<h1><span class="header-section-number">4</span> MAPEAR</h1>
<p>Llegamos al final del curso y ahora nos toca <strong>visualizar en un mapa toda la información</strong> que estuvimos analizando las clases anteriores. Para esto, vamos a trabajar con la información geográfica que contiene nuestro dataset y vamos agregar otras fuentes de datos geográficos.</p>
<p>Pero antes de empezar, ¿A que nos referimos cuando hablamos de <strong>Sistemas de Información Geográfica</strong> o <strong>SIG</strong>? Bueno, nos referimos a las herramientas informáticas que nos permiten ubicar y analizar un conjunto de datos en lugares específicos del territorio (georreferenciar).</p>
<p>Para poder hacer uso de los SIG necesitamos contar con información geográfica en nuestro dataset, es decir, que además de la información que ya vimos que puede haber en un dataset tradicional, se sume un componente espacial en cada registro (partido, barrio, manzana, calle o directamente las coordenadas X e Y).</p>
<p>Las herramientas que nos permitirán visualizar toda esta información serán los <strong>mapas</strong>, que son nada más y nada menos que representaciones planas, reducidas y simplificadas de la tierra que nos dan la posibilidad cruzar y relacionar datos en el espacio. Es decir que, mantienen una relación ordenada en el traspaso de puntos ubicados en la superficie curva de la tierra a puntos ubicados en la superficie plana de los mapas. Esto es posible a partir del uso de sistemas de coordenadas proyectadas.</p>
<p>En R hay varios paquetes de funciones que nos permiten manipular este tipo de información, entre los que se encuentra <code>sf</code>, que lo aprenderemos hoy. Para comenzar a utilizarlo vamos a tener que instalarlo y luego activarlo con <em>library()</em> al igual que lo veníamos haciendo con <code>tidyverse</code>:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb146-2"><a href="#cb146-2"></a><span class="co">#install.packages(sf)</span></span>
<span id="cb146-3"><a href="#cb146-3"></a><span class="kw">library</span>(sf)</span></code></pre></div>
<p>Como verán, activamos los 2 paquetes porque ambos presentan funciones que son necesarias a la hora de mapear información.</p>
<div id="analizar-datos-espaciales" class="section level2">
<h2><span class="header-section-number">4.1</span> Analizar datos espaciales</h2>
<p>Llegó el momento de conocer y analizar datos espaciales. Para esto, como hicimos en cada clase, volvamos a cargar nuestros datos de Properati:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a>datos_amba &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/amba_properati.csv&quot;</span>)</span></code></pre></div>
<p>Y repasemos el gráfico que generamos la clase pasada con <code>geom_point()</code> asignando la variable longitud (lon) en el eje X y la latitud (lat) en el Y:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1"></a><span class="kw">ggplot</span>(datos_amba) <span class="op">+</span></span>
<span id="cb148-2"><a href="#cb148-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>lon, <span class="dt">y=</span>lat, <span class="dt">color=</span>provincia))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-154-1.png" width="1050" /></p>
<p>Con mucha imaginación uno puede darse cuenta que los datos tienen la forma de AMBA, pero está faltando información que nos facilite la lectura del mismo. Para esto sumemos un dataset más a nuestro proyecto que en este caso, será un dataset espacial en formato shapefile (SHP) con las geometrías correspondientes a todos los partidos de AMBA. Pueden descargarlo (es un .zip que contiene el SHP) en el siguiente link: <a href="https://data.world/angie-scetta/partidos-amba" class="uri">https://data.world/angie-scetta/partidos-amba</a></p>
<p><em>Recomendación: Al igual que con el csv que trabajamos en las clases anteriores, al descargar el shape deberán moverlo de la carpeta “Descargas” a la carpeta llamada “data” dentro del Proyecto donde estan trabajando.</em></p>
<p>Para poder cargar nuestros datos espaciales en formato shp utilizaremos la función <code>st_read()</code> de la siguiente forma:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1"></a>partidos_amba &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/partidos_amba.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `partidos_amba&#39; from data source `E:\03-OTROS\SCA-CURSOS-2020\sca-big-data-urbana\data\partidos_amba.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 48 features and 3 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -59.3392 ymin: -35.23893 xmax: -57.70946 ymax: -34.23007
## CRS:            4326</code></pre>
<p>Veamos que información contiene:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1"></a><span class="kw">head</span>(partidos_amba)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 3 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -59.05579 ymin: -34.91331 xmax: -58.27953 ymax: -34.26732
## CRS:            4326
##       nombre provincia area_km2                       geometry
## 1 Avellaneda       GBA    57.25 MULTIPOLYGON (((-58.33444 -...
## 2      Tigre       GBA   381.99 MULTIPOLYGON (((-58.5167 -3...
## 3      Pilar       GBA   382.95 MULTIPOLYGON (((-58.90312 -...
## 4     Moreno       GBA   186.36 MULTIPOLYGON (((-58.82401 -...
## 5      Merlo       GBA   173.97 MULTIPOLYGON (((-58.72917 -...
## 6 La Matanza       GBA   328.26 MULTIPOLYGON (((-58.52885 -...</code></pre>
<p>Las primeras 3 columnas presentan el nombre del partido, la provincia y el área en km2. Hasta acá son datos muy similares a las que ya veníamos encontrando en los dataset tradicionales; sin embargo, aparece una 4ta columna llamada “geometry” que hasta ahora no la habíamos visto y es donde se aloja la geometría de cada uno de los registros. La información de este campo es la que hace que el dataset sea espacial.</p>
<p>Si queda alguna duda, podemos utilizar la función <code>class()</code> para ver con que tipo de datos estamos trabajando:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1"></a><span class="kw">class</span>(datos_amba)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>Tal como lo imaginábamos, datos_amba es un simple dataframe.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1"></a><span class="kw">class</span>(partidos_amba)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<p>Pero partidos_amba, es un dataset espacial u objeto del tipo “sf”, que hace referencia a “simple features” por estar compuesto de geometrías bidimensionales (polígono, punto, línea, multipunto, multilínea, etc.).</p>
<p>Para poder visualizar toda esta información plasmada en un mapa vamos a utilizar nuevamente <code>ggplot()</code> pero como en esta oportunidad queremos sumar capas geográficas (sf) trabajaremos con <code>geom_sf()</code>. Veamos un ejemplo:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1"></a><span class="kw">ggplot</span>(partidos_amba)<span class="op">+</span></span>
<span id="cb157-2"><a href="#cb157-2"></a><span class="st">  </span><span class="kw">geom_sf</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-159-1.png" width="1050" /></p>
<p>Como habrán notado, la lógica en la estructura del chunk que utilizamos para hacer este mapa es la misma del capítulo anterior, donde dentro del ggplot() asignamos el dataset y luego sumamos la capa a graficar/mapear (en este caso un objeto sf).</p>
<p>En el mapa podemos ver como las geometrías de cada registro del dataset espacial son polígonos que representan los partidos de AMBA. Probemos agregar algún atributo estético <code>aes()</code>:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1"></a><span class="kw">ggplot</span>(partidos_amba)<span class="op">+</span></span>
<span id="cb158-2"><a href="#cb158-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>area_km2))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-160-1.png" width="1050" /></p>
<p>Ya tenemos nuestro primer <strong>mapa coroplético</strong>. Probemos ajustando algunas cuestiones estéticas: cambiemos la paleta (y su escala) y el color del borde de los polígonos.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1"></a><span class="kw">ggplot</span>(partidos_amba)<span class="op">+</span></span>
<span id="cb159-2"><a href="#cb159-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>area_km2), <span class="dt">color=</span><span class="st">&quot;white&quot;</span>)<span class="op">+</span></span>
<span id="cb159-3"><a href="#cb159-3"></a><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">250</span>,<span class="dv">500</span>,<span class="dv">750</span>,<span class="dv">1000</span>))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-161-1.png" width="1050" /></p>
<p>Y ahora si queremos visualizar en un mismo mapa el dataset espacial (partidos_amba) y el dataset tradicional (datos_amba) tenemos que tener en cuenta 2 cosas:</p>
<ol style="list-style-type: decimal">
<li><p>Cuando utilizamos 2 capas (en este caso <code>geom_sf()</code> y <code>geom_point()</code>), tenemos que asignarle a cada una el dataset dentro de la capa y <code>ggplot()</code> queda “vacío”.</p></li>
<li><p>Las capas se grafican en el mismo orden que se escribe el código, es decir que la que agregamos primero (en este caso partidos_amba) será el fondo de la que agreguemos luego (datos_amba).</p></li>
</ol>
<p>Veamos esto en detalle:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb160-2"><a href="#cb160-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>partidos_amba)<span class="op">+</span></span>
<span id="cb160-3"><a href="#cb160-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>datos_amba, <span class="kw">aes</span>(<span class="dt">x=</span>lon, <span class="dt">y=</span>lat, <span class="dt">color=</span>provincia))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-162-1.png" width="1050" /></p>
<p>En el mapa anterior hay tantos puntos que nos resulta muy difícil poder encontrar patrones que nos permitan entender donde se concentran más cantidad de puntos y donde menos. En estos casos podemos recurrir a los <strong>mapas de densidad de puntos</strong> que nos ayudarán a encontrar los “hot spots”.</p>
<p>En R hay varias formas de mapear esto, pero hoy optaremos por <code>geom_bin2d()</code>, que divide el plano en una grilla y cuenta la cantidad de puntos que aparecen en cada celda.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb161-2"><a href="#cb161-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>partidos_amba)<span class="op">+</span></span>
<span id="cb161-3"><a href="#cb161-3"></a><span class="st">  </span><span class="kw">geom_bin2d</span>(<span class="dt">data =</span> datos_amba, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-163-1.png" width="1050" /></p>
<p>Ahora si nos encontramos con un hot spot que antes no veíamos. Se ve muy claro como en Palermo se concentran la mayor cantidad de propiedades publicadas en Junio y Julio en Properati. Pero, ¿Existirá una diferencia entre los 2 meses? Respondamos esto con un facetado por created_on:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb162-2"><a href="#cb162-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>partidos_amba)<span class="op">+</span></span>
<span id="cb162-3"><a href="#cb162-3"></a><span class="st">  </span><span class="kw">geom_bin2d</span>(<span class="dt">data =</span> datos_amba, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat))<span class="op">+</span></span>
<span id="cb162-4"><a href="#cb162-4"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>created_on)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-164-1.png" width="1050" /></p>
<p>Claramente los patrones de ambos meses son muy parecidos, así que mantengamos un único mapa pero cambiemos el color y el tamaño de los bins (celdas):</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb163-2"><a href="#cb163-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>partidos_amba)<span class="op">+</span></span>
<span id="cb163-3"><a href="#cb163-3"></a><span class="st">  </span><span class="kw">geom_bin2d</span>(<span class="dt">data =</span> datos_amba, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat), <span class="dt">alpha=</span><span class="fl">0.75</span>, <span class="dt">bins=</span><span class="dv">50</span>)<span class="op">+</span></span>
<span id="cb163-4"><a href="#cb163-4"></a><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-165-1.png" width="1050" /></p>
<p>¿Y cómo hacemos si queremos ver este mapa con un “zoom” solo de CABA?</p>
<p>Tenemos que filtrar ambas capas así:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb164-2"><a href="#cb164-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span><span class="kw">filter</span>(partidos_amba, provincia<span class="op">==</span><span class="st">&quot;CABA&quot;</span>))<span class="op">+</span></span>
<span id="cb164-3"><a href="#cb164-3"></a><span class="st">  </span><span class="kw">geom_bin2d</span>(<span class="dt">data =</span> <span class="kw">filter</span>(datos_amba, provincia<span class="op">==</span><span class="st">&quot;CABA&quot;</span>), <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat), <span class="dt">alpha=</span><span class="fl">0.75</span>)<span class="op">+</span></span>
<span id="cb164-4"><a href="#cb164-4"></a><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-166-1.png" width="1050" /></p>
<p>Viendo el mapa anterior nos cambia un poco la percepción y ya no parecería ser solo la Comuna 14 la que tiene la mayor densidad de propiedades, sino que se ve una zona con gran densidad en la Comuna 15 (por Villa Crespo).</p>
<p>Pero bueno, a pesar de haber llegado a un mapa que nos permitió sacar muchas conclusiones, aún estamos trabajando con 2 dataset separados que no se han unido. ¡Veamos como cruzar y unificar todos estos datos!</p>
</div>
<div id="cruzar-datos-tradicionales-y-espaciales" class="section level2">
<h2><span class="header-section-number">4.2</span> Cruzar datos tradicionales y espaciales</h2>
<p>Es muy común que a la hora de trabajar con datos no encontremos toda la información que necesitamos en un solo dataset. Frente a esto, lo que se hace es unir/cruzar datos provenientes de diferentes fuentes de información. En este apartado veremos como realizar estos cruces entre datos tradicionales y espaciales.</p>
<p>Para poder unir 2 set de datos ambos tienen que tener algo en común (alguna columna como por ejemplo un ID), sino sería imposible que R entienda que tiene que unir con qué. Por lo tanto, antes de unirlos deberemos manipularlos y realizarles diferentes tipos de transformaciones que nos permitan llegar a generar esta variable en común.</p>
<p>Por ejemplo en nuestro caso, si queremos unir algún dato a nuestro dataset espacial de partidos, deberíamos tener un valor único por cada nombre de partido (que funciona como el ID de mi dataset espacial).</p>
<p>Trabajemos con las propiedades en venta y manipulemos un poco el dataset tradicional para que podamos unirlos:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1"></a>datos_amba_venta &lt;-<span class="st"> </span>datos_amba <span class="op">%&gt;%</span></span>
<span id="cb165-2"><a href="#cb165-2"></a><span class="st">  </span><span class="kw">filter</span>(operation_type<span class="op">==</span><span class="st">&quot;Venta&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb165-3"><a href="#cb165-3"></a><span class="st">  </span><span class="kw">group_by</span>(partido) <span class="op">%&gt;%</span></span>
<span id="cb165-4"><a href="#cb165-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">cantidad=</span><span class="kw">n</span>(),</span>
<span id="cb165-5"><a href="#cb165-5"></a>            <span class="dt">valor_m2=</span><span class="kw">mean</span>(price<span class="op">/</span>surface_covered))</span></code></pre></div>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1"></a><span class="kw">head</span>(datos_amba_venta)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   partido         cantidad valor_m2
##   &lt;fct&gt;              &lt;int&gt;    &lt;dbl&gt;
## 1 Almirante Brown       24    1824.
## 2 Avellaneda            67    1487.
## 3 Berazategui           47    1787.
## 4 Berisso                3     952.
## 5 Cañuelas               3    1293.
## 6 Comuna 1             542    3526.</code></pre>
<p>Bien, ahora que tenemos un dataset de 50 observaciones/registros (partidos) donde para cada partido hay 2 columnas con valores asociados (cantidad y valor del m2), ya estamos en condiciones de hacer una unión con el dataset espacial.</p>
<p>Para esto utilizaremos la función <code>left_join()</code>:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1"></a>partidos_amba &lt;-<span class="st"> </span><span class="kw">left_join</span>(partidos_amba, datos_amba_venta, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;nombre&quot;</span>=<span class="st">&quot;partido&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1"></a><span class="kw">head</span>(partidos_amba)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 5 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -59.05579 ymin: -34.91331 xmax: -58.27953 ymax: -34.26732
## CRS:            4326
##       nombre provincia area_km2 cantidad valor_m2
## 1 Avellaneda       GBA    57.25       67 1486.522
## 2      Tigre       GBA   381.99      887 2674.501
## 3      Pilar       GBA   382.95      493 1680.706
## 4     Moreno       GBA   186.36       64 1202.036
## 5      Merlo       GBA   173.97       83 1146.151
## 6 La Matanza       GBA   328.26      110 1592.995
##                         geometry
## 1 MULTIPOLYGON (((-58.33444 -...
## 2 MULTIPOLYGON (((-58.5167 -3...
## 3 MULTIPOLYGON (((-58.90312 -...
## 4 MULTIPOLYGON (((-58.82401 -...
## 5 MULTIPOLYGON (((-58.72917 -...
## 6 MULTIPOLYGON (((-58.52885 -...</code></pre>
<p>Tal como esperábamos, se agregaron 2 nuevas columnas: cantidad y valor_m2.</p>
<p>Veamos esto en un mapa:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1"></a><span class="kw">ggplot</span>(partidos_amba)<span class="op">+</span></span>
<span id="cb171-2"><a href="#cb171-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>valor_m2))<span class="op">+</span></span>
<span id="cb171-3"><a href="#cb171-3"></a><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-171-1.png" width="1050" /></p>
<p>Al igual que en los gráficos, en los mapas pueden agregarse etiquetas (título, subtítulo, etc) y cambiar el aspecto (theme):</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb172-2"><a href="#cb172-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>partidos_amba, <span class="kw">aes</span>(<span class="dt">fill=</span>valor_m2), <span class="dt">color=</span><span class="ot">NA</span>) <span class="op">+</span></span>
<span id="cb172-3"><a href="#cb172-3"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Valor del m2 en Venta por Partido&quot;</span>,</span>
<span id="cb172-4"><a href="#cb172-4"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;AMBA - Junio y Julio 2020&quot;</span>,</span>
<span id="cb172-5"><a href="#cb172-5"></a>         <span class="dt">fill =</span> <span class="st">&quot;USD/m2&quot;</span>,</span>
<span id="cb172-6"><a href="#cb172-6"></a>         <span class="dt">caption=</span> <span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb172-7"><a href="#cb172-7"></a><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>) <span class="op">+</span></span>
<span id="cb172-8"><a href="#cb172-8"></a><span class="st">  </span><span class="kw">theme_light</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-172-1.png" width="1050" /></p>
<p>Ahora mapiemos la otra nueva variable: cantidad de propiedades publicadas para venta.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb173-2"><a href="#cb173-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>partidos_amba, <span class="kw">aes</span>(<span class="dt">fill=</span>cantidad), <span class="dt">color=</span><span class="ot">NA</span>) <span class="op">+</span></span>
<span id="cb173-3"><a href="#cb173-3"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Cantidad de publicaciones de Venta por Partido&quot;</span>,</span>
<span id="cb173-4"><a href="#cb173-4"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;AMBA - Junio y Julio 2020&quot;</span>,</span>
<span id="cb173-5"><a href="#cb173-5"></a>         <span class="dt">fill =</span> <span class="st">&quot;Cantidad&quot;</span>,</span>
<span id="cb173-6"><a href="#cb173-6"></a>         <span class="dt">caption=</span> <span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb173-7"><a href="#cb173-7"></a><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>) <span class="op">+</span></span>
<span id="cb173-8"><a href="#cb173-8"></a><span class="st">  </span><span class="kw">theme_light</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-173-1.png" width="1050" /></p>
<p>En el mapa se ve como la Comuna 14 tiene el valor más alto, sin embargo, para que estos datos sean comparables entre todos los partidos, es necesario que calculemos una densidad relacionando la cantidad de propiedades y la superficie (km2) de cada uno:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb174-2"><a href="#cb174-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>partidos_amba, <span class="kw">aes</span>(<span class="dt">fill=</span>cantidad<span class="op">/</span>area_km2), <span class="dt">color=</span><span class="ot">NA</span>) <span class="op">+</span></span>
<span id="cb174-3"><a href="#cb174-3"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Densidad de publicaciones de Venta por Partido&quot;</span>,</span>
<span id="cb174-4"><a href="#cb174-4"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;AMBA - Junio y Julio 2020&quot;</span>,</span>
<span id="cb174-5"><a href="#cb174-5"></a>         <span class="dt">fill =</span> <span class="st">&quot;Densidad&quot;</span>,</span>
<span id="cb174-6"><a href="#cb174-6"></a>         <span class="dt">caption=</span> <span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb174-7"><a href="#cb174-7"></a><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>) <span class="op">+</span></span>
<span id="cb174-8"><a href="#cb174-8"></a><span class="st">  </span><span class="kw">theme_light</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-174-1.png" width="1050" /></p>
<p>El mapa cambia bastante, ahora todos los partidos de AMBA son color azul, es decir que tienen baja densidad y los de CABA se ven coloreados. Hagamos un zoom en CABA y veamos esto en detalle:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb175-2"><a href="#cb175-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span><span class="kw">filter</span>(partidos_amba, provincia<span class="op">==</span><span class="st">&quot;CABA&quot;</span>), <span class="kw">aes</span>(<span class="dt">fill=</span>cantidad<span class="op">/</span>area_km2), <span class="dt">color=</span><span class="ot">NA</span>) <span class="op">+</span></span>
<span id="cb175-3"><a href="#cb175-3"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Densidad de publicaciones de Venta por Comuna&quot;</span>,</span>
<span id="cb175-4"><a href="#cb175-4"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;CABA - Junio y Julio 2020&quot;</span>,</span>
<span id="cb175-5"><a href="#cb175-5"></a>         <span class="dt">fill =</span> <span class="st">&quot;Densidad&quot;</span>,</span>
<span id="cb175-6"><a href="#cb175-6"></a>         <span class="dt">caption=</span> <span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb175-7"><a href="#cb175-7"></a><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>) <span class="op">+</span></span>
<span id="cb175-8"><a href="#cb175-8"></a><span class="st">  </span><span class="kw">theme_light</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-175-1.png" width="1050" /></p>
<p>Podemos ver que aparece la Comuna 5 como la más densa seguida por la 14 y la 5. Sin embargo hay varias que tienen una densidad mayor a 50 publicaciones por km2. Veamos cuáles son:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb176-2"><a href="#cb176-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span><span class="kw">filter</span>(partidos_amba, provincia<span class="op">==</span><span class="st">&quot;CABA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>cantidad<span class="op">/</span>area_km2<span class="op">&gt;=</span><span class="dv">50</span>), <span class="kw">aes</span>(<span class="dt">fill=</span>cantidad<span class="op">/</span>area_km2), <span class="dt">color=</span><span class="ot">NA</span>) <span class="op">+</span></span>
<span id="cb176-3"><a href="#cb176-3"></a><span class="st">  </span><span class="kw">geom_sf_label</span>(<span class="dt">data=</span><span class="kw">filter</span>(partidos_amba, provincia<span class="op">==</span><span class="st">&quot;CABA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>cantidad<span class="op">/</span>area_km2<span class="op">&gt;=</span><span class="dv">50</span>), <span class="kw">aes</span>(<span class="dt">label =</span> nombre), <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb176-4"><a href="#cb176-4"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Comunas con más de 50 publicaciones por km2&quot;</span>,</span>
<span id="cb176-5"><a href="#cb176-5"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;CABA - Junio y Julio 2020&quot;</span>,</span>
<span id="cb176-6"><a href="#cb176-6"></a>         <span class="dt">fill =</span> <span class="st">&quot;Densidad&quot;</span>,</span>
<span id="cb176-7"><a href="#cb176-7"></a>         <span class="dt">caption=</span> <span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb176-8"><a href="#cb176-8"></a><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>) <span class="op">+</span></span>
<span id="cb176-9"><a href="#cb176-9"></a><span class="st">  </span><span class="kw">theme_light</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-176-1.png" width="1050" /></p>
<p>Y por último agreguémosle el mapa de fondo así las comunas no quedan flotando:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb177-2"><a href="#cb177-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span><span class="kw">filter</span>(partidos_amba, provincia<span class="op">==</span><span class="st">&quot;CABA&quot;</span>)) <span class="op">+</span></span>
<span id="cb177-3"><a href="#cb177-3"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span><span class="kw">filter</span>(partidos_amba, provincia<span class="op">==</span><span class="st">&quot;CABA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>cantidad<span class="op">/</span>area_km2<span class="op">&gt;=</span><span class="dv">50</span>), <span class="kw">aes</span>(<span class="dt">fill=</span>cantidad<span class="op">/</span>area_km2)) <span class="op">+</span></span>
<span id="cb177-4"><a href="#cb177-4"></a><span class="st">  </span><span class="kw">geom_sf_label</span>(<span class="dt">data=</span><span class="kw">filter</span>(partidos_amba, provincia<span class="op">==</span><span class="st">&quot;CABA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>cantidad<span class="op">/</span>area_km2<span class="op">&gt;=</span><span class="dv">50</span>), <span class="kw">aes</span>(<span class="dt">label =</span> nombre), <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb177-5"><a href="#cb177-5"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Cantidad de publicaciones de Venta por Comuna&quot;</span>,</span>
<span id="cb177-6"><a href="#cb177-6"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;CABA - Junio y Julio 2020&quot;</span>,</span>
<span id="cb177-7"><a href="#cb177-7"></a>         <span class="dt">fill =</span> <span class="st">&quot;Cantidad&quot;</span>,</span>
<span id="cb177-8"><a href="#cb177-8"></a>         <span class="dt">x=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb177-9"><a href="#cb177-9"></a>         <span class="dt">y=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb177-10"><a href="#cb177-10"></a>         <span class="dt">caption=</span> <span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb177-11"><a href="#cb177-11"></a><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>) <span class="op">+</span></span>
<span id="cb177-12"><a href="#cb177-12"></a><span class="st">  </span><span class="kw">theme_light</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-177-1.png" width="1050" /></p>
<p><strong>Variables Categóricas en el Mapa</strong></p>
<p>Hasta acá todos los mapas que desarrollamos tomaron color a partir de una variable numérica (cantidad o valor del m2), pero ¿Qué pasa si lo que queremos mapear es una variable categórica, cómo por ejemplo la tipología que más aparece publicada por partido?</p>
<p>Para resolver esta incógnita debemos generar una nueva variable que contenga la información y pueda unirse a nuestro dataset espacial partidos_amba:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1"></a>datos_amba_tipologia &lt;-<span class="st"> </span>datos_amba <span class="op">%&gt;%</span></span>
<span id="cb178-2"><a href="#cb178-2"></a><span class="st">  </span><span class="kw">group_by</span>(partido, property_type) <span class="op">%&gt;%</span></span>
<span id="cb178-3"><a href="#cb178-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">cant_max=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="cb178-4"><a href="#cb178-4"></a><span class="st">  </span><span class="kw">filter</span>(cant_max<span class="op">==</span><span class="kw">max</span>(cant_max))</span></code></pre></div>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1"></a><span class="kw">head</span>(datos_amba_tipologia)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
## # Groups:   partido [6]
##   partido         property_type cant_max
##   &lt;fct&gt;           &lt;fct&gt;            &lt;int&gt;
## 1 Almirante Brown Casa                19
## 2 Avellaneda      Departamento        47
## 3 Berazategui     Departamento        35
## 4 Berisso         Casa                 3
## 5 Cañuelas        Casa                 3
## 6 Comuna 1        Departamento       739</code></pre>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1"></a>partidos_amba &lt;-<span class="st"> </span>partidos_amba <span class="op">%&gt;%</span></span>
<span id="cb181-2"><a href="#cb181-2"></a><span class="st">  </span><span class="kw">left_join</span>(datos_amba_tipologia, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;nombre&quot;</span>=<span class="st">&quot;partido&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1"></a><span class="kw">head</span>(partidos_amba)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 7 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -59.05579 ymin: -34.91331 xmax: -58.27953 ymax: -34.26732
## CRS:            4326
##       nombre provincia area_km2 cantidad valor_m2 property_type cant_max
## 1 Avellaneda       GBA    57.25       67 1486.522  Departamento       47
## 2      Tigre       GBA   381.99      887 2674.501  Departamento      898
## 3      Pilar       GBA   382.95      493 1680.706          Casa      353
## 4     Moreno       GBA   186.36       64 1202.036          Casa       50
## 5      Merlo       GBA   173.97       83 1146.151          Casa       54
## 6 La Matanza       GBA   328.26      110 1592.995  Departamento       73
##                         geometry
## 1 MULTIPOLYGON (((-58.33444 -...
## 2 MULTIPOLYGON (((-58.5167 -3...
## 3 MULTIPOLYGON (((-58.90312 -...
## 4 MULTIPOLYGON (((-58.82401 -...
## 5 MULTIPOLYGON (((-58.72917 -...
## 6 MULTIPOLYGON (((-58.52885 -...</code></pre>
<p>Efectivamente, se sumaron 2 nuevas columnas: property_type y cant_max. Ahora si, mapiemos por la tipología que más aparece:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1"></a><span class="kw">ggplot</span>(partidos_amba)<span class="op">+</span></span>
<span id="cb184-2"><a href="#cb184-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>property_type))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-182-1.png" width="1050" /></p>
<p>Y modifiquemos su estética como ya aprendimos:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1"></a><span class="kw">ggplot</span>(partidos_amba)<span class="op">+</span></span>
<span id="cb185-2"><a href="#cb185-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>property_type), <span class="dt">color=</span><span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb185-3"><a href="#cb185-3"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Tipología que predomina en las publicaciones por Partido&quot;</span>,</span>
<span id="cb185-4"><a href="#cb185-4"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;AMBA - Junio y Julio 2020&quot;</span>,</span>
<span id="cb185-5"><a href="#cb185-5"></a>         <span class="dt">fill =</span> <span class="st">&quot;Tipología&quot;</span>,</span>
<span id="cb185-6"><a href="#cb185-6"></a>         <span class="dt">caption=</span> <span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb185-7"><a href="#cb185-7"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;darkseagreen1&quot;</span>, <span class="st">&quot;cyan4&quot;</span>))<span class="op">+</span></span>
<span id="cb185-8"><a href="#cb185-8"></a><span class="st">  </span><span class="kw">theme_light</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-183-1.png" width="1050" /></p>
</div>
<div id="cruzar-datos-espaciales" class="section level2">
<h2><span class="header-section-number">4.3</span> Cruzar datos espaciales</h2>
<p>Muchas veces nos vamos a encontrar con que queremos unir 2 dataset pero no tienen columnas en común y es imposible generarlas; pero hay <strong>algo que si tienen en común y que nos permitirá unirlos: la ubicación en el espacio</strong>. A esto nos referimos cuando hablamos de “Spatial Join” o “Unión Espacial” y en R lo haremos a partir de la función <code>st_join()</code> que forma parte del paquete <code>sf</code>.</p>
<p>Pero antes de seguir, nos está faltando un segundo dataset espacial ya que hasta ahora solo tenemos uno. Como primer paso vamos a tener que transformar nuestro dataset tradicional “datos_amba” a un dataset espacial utilizando la función <code>st_as_sf()</code> de la siguiente forma:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1"></a>datos_amba_geo &lt;-<span class="st"> </span>datos_amba <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb186-2"><a href="#cb186-2"></a><span class="st">    </span><span class="kw">st_as_sf</span>(<span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>), <span class="dt">crs =</span> <span class="dv">4326</span>)</span></code></pre></div>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1"></a><span class="kw">head</span>(datos_amba_geo)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 11 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -58.52914 ymin: -34.66253 xmax: -58.3609 ymax: -34.53344
## CRS:            EPSG:4326
##   created_on provincia       partido rooms surface_total surface_covered
## 1     202006      CABA      Comuna 7     1            40              37
## 2     202006      CABA     Comuna 13     1            30              30
## 3     202006      CABA     Comuna 13     1            31              29
## 4     202006      CABA      Comuna 1     1            35              35
## 5     202006       GBA Vicente López     1            36              27
## 6     202006       GBA    La Matanza     2            24              24
##   price currency
## 1 22500      ARS
## 2 18000      ARS
## 3 17900      ARS
## 4 42000      ARS
## 5 19000      ARS
## 6 12000      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type operation_type                    geometry
## 1  Departamento       Alquiler POINT (-58.46222 -34.61917)
## 2  Departamento       Alquiler  POINT (-58.46652 -34.5546)
## 3  Departamento       Alquiler POINT (-58.46461 -34.56318)
## 4  Departamento       Alquiler  POINT (-58.3609 -34.61836)
## 5  Departamento       Alquiler POINT (-58.49345 -34.53344)
## 6            PH       Alquiler POINT (-58.52914 -34.66253)</code></pre>
<p>Ahora si, nuestro dataset datos_amba se transformó en espacial y eso lo vemos con el reemplazo de sus columnas X e Y por una única columna llamada “geometry”. Hagamos un mapa y veamos que pasa:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1"></a><span class="kw">ggplot</span>(datos_amba_geo)<span class="op">+</span></span>
<span id="cb189-2"><a href="#cb189-2"></a><span class="st">  </span><span class="kw">geom_sf</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-186-1.png" width="1050" /></p>
<p>A simple vista son iguales que cuando hicimos el <code>geom_point()</code> pero la diferencia es que ahora son espaciales y ya estamos en condiciones de unirlos con otro dataset espacial. En este caso, como queremos generar información nueva, vamos a unirlos con un SHP que contenga información nueva que nuestros datos no tienen como por ejemplo los barrios de CABA a los que corresponde cada publicación.</p>
<p>Para esto vamos a descargar el SHP de <a href="https://data.world/angie-scetta/barrios-caba" class="uri">https://data.world/angie-scetta/barrios-caba</a>, guardarlo en la carpeta “data” y luego cargarlo de la siguiente forma:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1"></a>barrios_caba &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/barrios_caba.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `barrios_caba&#39; from data source `E:\03-OTROS\SCA-CURSOS-2020\sca-big-data-urbana\data\barrios_caba.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 48 features and 1 field
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -58.53152 ymin: -34.70529 xmax: -58.33515 ymax: -34.52649
## CRS:            4326</code></pre>
<p>Veamos los polígonos:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1"></a><span class="kw">ggplot</span>(barrios_caba)<span class="op">+</span></span>
<span id="cb192-2"><a href="#cb192-2"></a><span class="st">  </span><span class="kw">geom_sf</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-188-1.png" width="1050" /></p>
<p>Efectivamente tienen forma de los 48 barrios de CABA. Superpongamos los datos de Properati que convertimos en el paso anterior para ver cuanto se “solapan” con el SHP de barrios:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb193-2"><a href="#cb193-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>barrios_caba)<span class="op">+</span></span>
<span id="cb193-3"><a href="#cb193-3"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>datos_amba_geo, <span class="dt">alpha=</span><span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-189-1.png" width="1050" /></p>
<p>Como mi SHP solo contiene los barrios de CABA, obviamente solo se solapa con los puntos que corresponden a propiedades ubicadas en CABA.</p>
<p>Ahora si, hagamos nuestra unión espacial con <code>st_join()</code> para que, cada registro de datos_amba_geo sume una nueva columna que indique a que barrio pertenece:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1"></a>datos_caba_geo &lt;-<span class="st"> </span><span class="kw">st_join</span>(datos_amba_geo, barrios_caba)</span></code></pre></div>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1"></a><span class="kw">head</span>(datos_caba_geo)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 12 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -58.52914 ymin: -34.66253 xmax: -58.3609 ymax: -34.53344
## CRS:            EPSG:4326
##   created_on provincia       partido rooms surface_total surface_covered
## 1     202006      CABA      Comuna 7     1            40              37
## 2     202006      CABA     Comuna 13     1            30              30
## 3     202006      CABA     Comuna 13     1            31              29
## 4     202006      CABA      Comuna 1     1            35              35
## 5     202006       GBA Vicente López     1            36              27
## 6     202006       GBA    La Matanza     2            24              24
##   price currency
## 1 22500      ARS
## 2 18000      ARS
## 3 17900      ARS
## 4 42000      ARS
## 5 19000      ARS
## 6 12000      ARS
##                                                                           title
## 1                                                         Departamento - Flores
## 2                         Retasado! Monoambiente en Nuñez, excelente ubicación!
## 3                                                       Departamento - Belgrano
## 4                              Monoambiente con cochera. Zencity. Puerto Madero
## 5 Alquiler TORRE dpto de 1o2 ambientes - excelente luz y vista cochera optativa
## 6                                                        PH - Lomas Del Mirador
##   property_type operation_type        BARRIO                    geometry
## 1  Departamento       Alquiler        FLORES POINT (-58.46222 -34.61917)
## 2  Departamento       Alquiler         NUÑEZ  POINT (-58.46652 -34.5546)
## 3  Departamento       Alquiler      BELGRANO POINT (-58.46461 -34.56318)
## 4  Departamento       Alquiler PUERTO MADERO  POINT (-58.3609 -34.61836)
## 5  Departamento       Alquiler          &lt;NA&gt; POINT (-58.49345 -34.53344)
## 6            PH       Alquiler          &lt;NA&gt; POINT (-58.52914 -34.66253)</code></pre>
<p>Como verán, a cada registro se le unió una columna con el nombre del barrio con el que solapan, y a aquellas propiedades ubicadas fuera de CABA se les asignó un valor nulo o NA. Veamos esto en un mapa:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb197-2"><a href="#cb197-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>barrios_caba)<span class="op">+</span></span>
<span id="cb197-3"><a href="#cb197-3"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>datos_caba_geo, <span class="kw">aes</span>(<span class="dt">color=</span>BARRIO), <span class="dt">alpha=</span><span class="fl">0.5</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-192-1.png" width="1050" /></p>
<p>Se ve como todos los puntos que se ubican en CABA tienen color según sus barrios, pero los puntos fuera de CABA quedaron grises porque su valor es NA. Para “limpiar” esto filtremos todos los registros que tienen barrio asignado:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1"></a>datos_caba_geo &lt;-<span class="st"> </span>datos_caba_geo <span class="op">%&gt;%</span></span>
<span id="cb198-2"><a href="#cb198-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(BARRIO))</span></code></pre></div>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb199-2"><a href="#cb199-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>barrios_caba)<span class="op">+</span></span>
<span id="cb199-3"><a href="#cb199-3"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>datos_caba_geo, <span class="kw">aes</span>(<span class="dt">color=</span>BARRIO), <span class="dt">alpha=</span><span class="fl">0.5</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-194-1.png" width="1050" /></p>
<p>Ya tenemos solo los registros de CABA. ¿Y ahora cómo hacemos si queremos realizar un mapa coroplético como los anteriores pero coloreando los barrios según valor del m2? Nuevamente manipulamos el set de datos con <code>group_by()</code> y luego utilizamos <code>left_join()</code>:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1"></a>datos_caba_geo &lt;-<span class="st"> </span>datos_caba_geo <span class="op">%&gt;%</span></span>
<span id="cb200-2"><a href="#cb200-2"></a><span class="st">  </span><span class="kw">group_by</span>(BARRIO, operation_type) <span class="op">%&gt;%</span></span>
<span id="cb200-3"><a href="#cb200-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">valor_m2=</span><span class="kw">mean</span>(price<span class="op">/</span>surface_covered))</span></code></pre></div>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1"></a><span class="kw">head</span>(datos_caba_geo)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 3 fields
## geometry type:  MULTIPOINT
## dimension:      XY
## bbox:           xmin: -58.50249 ymin: -34.62174 xmax: -58.39217 ymax: -34.58573
## CRS:            EPSG:4326
## # A tibble: 6 x 4
## # Groups:   BARRIO [3]
##   BARRIO  operation_type valor_m2                                  geometry
##   &lt;fct&gt;   &lt;fct&gt;             &lt;dbl&gt;                         &lt;MULTIPOINT [Â°]&gt;
## 1 AGRONO~ Alquiler           471. ((-58.50249 -34.59347), (-58.49966 -34.5~
## 2 AGRONO~ Venta             2869. ((-58.49994 -34.59319), (-58.49984 -34.5~
## 3 ALMAGRO Alquiler           488. ((-58.43224 -34.60375), (-58.43216 -34.6~
## 4 ALMAGRO Venta             2714. ((-58.43277 -34.60322), (-58.43229 -34.6~
## 5 BALVAN~ Alquiler           478. ((-58.4128 -34.6028), (-58.41252 -34.609~
## 6 BALVAN~ Venta             2211. ((-58.41409 -34.61113), (-58.41314 -34.6~</code></pre>
<p>Pero como vimos al principio de la clase, si usamos <code>left_join()</code>, uno de los dataset no tiene que ser espacial. Para esto, transformemos nuestro dataset espacial data_caba_geo a un dataset tradicional, quitándole la geometría con <code>st_set_geometry()</code>:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1"></a>datos_caba_geo &lt;-<span class="st"> </span>datos_caba_geo <span class="op">%&gt;%</span></span>
<span id="cb203-2"><a href="#cb203-2"></a><span class="st">  </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>)</span></code></pre></div>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1"></a><span class="kw">head</span>(datos_caba_geo)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
## # Groups:   BARRIO [3]
##   BARRIO    operation_type valor_m2
##   &lt;fct&gt;     &lt;fct&gt;             &lt;dbl&gt;
## 1 AGRONOMIA Alquiler           471.
## 2 AGRONOMIA Venta             2869.
## 3 ALMAGRO   Alquiler           488.
## 4 ALMAGRO   Venta             2714.
## 5 BALVANERA Alquiler           478.
## 6 BALVANERA Venta             2211.</code></pre>
<p>Ahora si, solo tiene 3 columnas con el nombre del barrio, la operación inmobiliaria y el valor del m2 pero ya no tiene geometría. Procedamos a realizar la unión:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1"></a>barrios_caba &lt;-<span class="st"> </span><span class="kw">left_join</span>(barrios_caba, datos_caba_geo, <span class="dt">by=</span><span class="st">&quot;BARRIO&quot;</span>)</span></code></pre></div>
<p>Y a mapear el valor de Venta:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb207-2"><a href="#cb207-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span><span class="kw">filter</span>(barrios_caba, operation_type<span class="op">==</span><span class="st">&quot;Venta&quot;</span>), <span class="kw">aes</span>(<span class="dt">fill=</span>valor_m2))</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-200-1.png" width="1050" /></p>
<p>Ya tenemos un mapa de valor del m2 en Venta por Barrio, y como siempre Puerto Madero presenta el valor más alto. Mejoremos su estética:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb208-2"><a href="#cb208-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span><span class="kw">filter</span>(barrios_caba, operation_type<span class="op">==</span><span class="st">&quot;Venta&quot;</span>), <span class="kw">aes</span>(<span class="dt">fill=</span>valor_m2), <span class="dt">color=</span><span class="ot">NA</span>)<span class="op">+</span></span>
<span id="cb208-3"><a href="#cb208-3"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Valor del m2 de Venta&quot;</span>,</span>
<span id="cb208-4"><a href="#cb208-4"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;CABA - Junio y Julio 2020&quot;</span>,</span>
<span id="cb208-5"><a href="#cb208-5"></a>         <span class="dt">fill =</span> <span class="st">&quot;USD/m2&quot;</span>,</span>
<span id="cb208-6"><a href="#cb208-6"></a>         <span class="dt">caption=</span> <span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb208-7"><a href="#cb208-7"></a><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;YlOrRd&quot;</span>, <span class="dt">direction =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb208-8"><a href="#cb208-8"></a><span class="st">  </span><span class="kw">theme_light</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-201-1.png" width="1050" /></p>
<p>Y el de valor del m2 en alquiler:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb209-2"><a href="#cb209-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span><span class="kw">filter</span>(barrios_caba, operation_type<span class="op">==</span><span class="st">&quot;Alquiler&quot;</span>), <span class="kw">aes</span>(<span class="dt">fill=</span>valor_m2), <span class="dt">color=</span><span class="ot">NA</span>)<span class="op">+</span></span>
<span id="cb209-3"><a href="#cb209-3"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Valor del m2 de Alquiler&quot;</span>,</span>
<span id="cb209-4"><a href="#cb209-4"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;CABA - Junio y Julio 2020&quot;</span>,</span>
<span id="cb209-5"><a href="#cb209-5"></a>         <span class="dt">fill =</span> <span class="st">&quot;ARS/m2&quot;</span>,</span>
<span id="cb209-6"><a href="#cb209-6"></a>         <span class="dt">caption=</span> <span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb209-7"><a href="#cb209-7"></a><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;YlOrRd&quot;</span>, <span class="dt">direction =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb209-8"><a href="#cb209-8"></a><span class="st">  </span><span class="kw">theme_light</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-202-1.png" width="1050" /></p>
<p>En el mapa anterior se puede observar que hay barrios en el sur de la Ciudad que directamente no tienen propiedades en alquiler.</p>
</div>
<div id="agregar-mapa-base" class="section level2">
<h2><span class="header-section-number">4.4</span> Agregar mapa base</h2>
<p>Si bien hasta aquí hemos hecho mapas bastante completos, nunca está de más agregarles un fondo que nos ayude a interpretar el contexto. Para lograr esto utilizaremos la librería <code>ggmap()</code> que cómo ya sabemos, primero debemos instalarla y luego activarla:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1"></a><span class="co">#install.packages(ggmap)</span></span>
<span id="cb210-2"><a href="#cb210-2"></a><span class="kw">library</span>(ggmap)</span></code></pre></div>
<p>Para poder obtener un mapa de fondo con ggmap, primero tengo que delimintar cuál es mi “bounding box”, que hace referencia a los límites de un cuadro en el cual se encuentran todos mis datos. Esto lo haremos de la siguiente forma:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1"></a>bbox_barrios &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">st_bbox</span>(barrios_caba))</span></code></pre></div>
<p>Una vez que ya tenemos el bbox, vamos a usar get_stamenmap() para descargar de internet el mapa. En este caso utilizaremos un mapa de tipo “toner-lite” pero hay otras opciones que pueden verse aquí: <a href="http://maps.stamen.com/" class="uri">http://maps.stamen.com/</a></p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1"></a>mapa_caba &lt;-<span class="st"> </span><span class="kw">get_stamenmap</span>(<span class="dt">bbox =</span> bbox_barrios,</span>
<span id="cb212-2"><a href="#cb212-2"></a>                      <span class="dt">maptype =</span> <span class="st">&quot;toner-lite&quot;</span>,</span>
<span id="cb212-3"><a href="#cb212-3"></a>                      <span class="dt">zoom=</span><span class="dv">12</span>)</span></code></pre></div>
<p>Con <code>ggmap()</code> veamos que nos hemos descargado:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1"></a><span class="kw">ggmap</span>(mapa_caba)</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-206-1.png" width="1050" /></p>
<p>Ahora podemos reutilizar el código del ejemplo de mapa del valor de m2 de venta por barrio, simplemente reemplazando la primera línea, donde inicializamos un objeto ggplot por una línea que llame a nuestro mapa base de la siguiente forma:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1"></a><span class="kw">ggmap</span>(mapa_caba)<span class="op">+</span></span>
<span id="cb214-2"><a href="#cb214-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span><span class="kw">filter</span>(barrios_caba, operation_type<span class="op">==</span><span class="st">&quot;Venta&quot;</span>), <span class="kw">aes</span>(<span class="dt">fill=</span>valor_m2), <span class="dt">alpha=</span><span class="fl">0.75</span>, <span class="dt">inherit.aes =</span> <span class="ot">FALSE</span>)<span class="op">+</span></span>
<span id="cb214-3"><a href="#cb214-3"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Valor del m2 de Venta&quot;</span>,</span>
<span id="cb214-4"><a href="#cb214-4"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;CABA - Junio y Julio 2020&quot;</span>,</span>
<span id="cb214-5"><a href="#cb214-5"></a>         <span class="dt">fill =</span> <span class="st">&quot;USD/m2&quot;</span>,</span>
<span id="cb214-6"><a href="#cb214-6"></a>         <span class="dt">caption=</span> <span class="st">&quot;Fuente: Properati&quot;</span>) <span class="op">+</span></span>
<span id="cb214-7"><a href="#cb214-7"></a><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;YlOrRd&quot;</span>, <span class="dt">direction =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb214-8"><a href="#cb214-8"></a><span class="st">  </span><span class="kw">theme_light</span>()</span></code></pre></div>
<p><img src="manual-big-data-urbana_files/figure-html/unnamed-chunk-207-1.png" width="1050" /></p>
<p>Además de cambiar la primer línea de código, nótese que agregamos un inherit.aes=FALSE dentro del geom_sf() para anular la estética predeterminada del objeto ggmap.</p>
<p>Y listo! Ya tenemos un mapa con fondo y con información que generamos nosotros a partir de un cruce espacial.</p>
<!--chapter:end:04-mapear.Rmd-->
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

</body>

</html>
