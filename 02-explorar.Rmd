# EXPLORAR

Ahora que ya sabemos abrir un dataset y conocer que información tiene, vamos a aprender a manipular y transformar los datos. Para esto hoy vamos a aprender uno de los paquetes más usados y más útiles de R que se llama `tidyverse`.

Pero ¿Qué es un paquete?

Cuando instalamos R ya viene con múltiples funciones básicas para manipular datos, sin embargo el potencial de R surge con la posibilidad de incorporar constantemente nuevas funciones que nos permitan realizar nuevas tareas o mejorar las ya existentes.

Estos grupos de funciones son a los que llamamos paquetes o packages y para poder utilizarlos es necesario **instalarlos por única vez en la computadora**, y luego **activarlos cada vez que vayamos a usarlos**.

Comencemos instalándolo. Esto podemos hacerlo manualmente en Tools/Install packages:

![](E:/03-OTROS/SCA-CURSOS-2020/capturas/024.jpg)

O directamente escribiendo `install.packages(tidyverse)` adentro de un chunk:

```{r}
#install.packages("tidyverse")
```

Una vez que instalamos el paquete, no vamos a tener que volver a hacerlo. Solamente vamos a tener que "activarlo" cada vez que quiera usarlo. Esto se hace con `library(tidyverse)`:

```{r}
library(tidyverse)
```

Antes de comenzar volvamos a cargar nuestro dataset:

```{r}
datos_amba <- read.csv("data/amba_properati.csv")
```

A continuación veremos como el paquete `tidyverse` nos va a permitir **filtrar**, **modificar**,  **seleccionar**, **ordenar**, **renombrar**, **resumir** y **agrupar** los datos.

## **FILTRAR**

Filtrar, como su nombre lo indica, hace referencia a realizar un filtro determinado sobre los registros/filas de toda la base de datos. Gráficamente se vería como algo así:

![](E:/03-OTROS/SCA-CURSOS-2020/capturas/tidyverse_filtrar.jpg)

Es decir que, nos será muy útil si por algún motivo queremos dejar de lado algunos registros y utilizar solo una parte de la base, por ejemplo podríamos filtrar los registros ubicados en CABA:

```{r}
filtro <- filter(datos_amba, provincia=="CABA")

head(filtro)
```

O los del mes de Julio 2020:

```{r}
a <- filter(datos_amba, created_on==202007)

head(a)
```

Nótese que para filtrar bajo la condición de "igual" utilicé "==", pero también podría haber utilizado otras condiciones como:

- **==**   igual a 
- **!=**   diferente a
- **<**    menor a 
- **<=**   menor o igual a 
- **>**    mayor a 
- **>=**   mayor o igual a

Entonces, por ejemplo si quiero filtrar solo las propiedades que tienen una superficie cubierta mayor o igual a 75m2 debería escribirlo así:

```{r}
filtro <- filter(datos_amba, surface_covered>=75)

head(filtro)
```

Pero no solo esto, ¿Cómo hago si quiero filtrar por 2 o más condiciones **a la vez**?

En este caso debemos utilizar los siguientes operadores lógicos:

- condición 1 **&** condición 2         se cumplen ambas condiciones a la vez
- condición 1 **|** condición 2         se cumple solo una u otra de las condiciones
- condición 1 **& !**condición 2        se cumple la condición 1 pero no la condición 2
- **!**condición 1 **&** condición 2    no se cumple la condición 1 pero si la condición 2
- **!**(condición 1 **&** condición 2)  no se cumple ninguna de las 2 condiciones 

```{r}
filtro <- filter(datos_amba, partido=="Comuna 13" | partido=="Comuna 5")

head(filtro)
```

```{r}
filtro <- filter(datos_amba, surface_total>=100 & operation_type=="Alquiler")

head(filtro)
```

## **MODIFICAR**

```{r}
modificar <- mutate(datos_amba, price_m2=price/surface_covered)

head(modificar)
```

## **SELECCIONAR**

```{r}
seleccion <- select(datos_amba, created_on, provincia, price, currency)

head(seleccion)
```

```{r}
seleccion <- select(datos_amba, -title)

head(seleccion)
```

```{r}
seleccion <- select(datos_amba, price:operation_type)

head(seleccion)
```

```{r}
seleccion <- select(datos_amba, 7:10)

head(seleccion)
```

```{r}
seleccion <- select(datos_amba, starts_with("p"))

head(seleccion)
```

```{r}
seleccion <- select(datos_amba, ends_with("e"))

head(seleccion)
```

```{r}
seleccion <- select(datos_amba, contains("surface"))

head(seleccion)
```

## **RESUMIR**

```{r}
a <- mutate(a, price_m2=price/surface_covered)
a <- select(a, -price)
summarise(a, price_m2=median(price_m2))

a <- group_by(a, partido)
a <- summarise(a, price_m2=median(price_m2))

a <- arrange(a, desc(price_m2))
head(a)
```